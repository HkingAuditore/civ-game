import{I as L,g as q,c as H,a as X,B as J,R as U,h as D}from"./index-DeasWbSb.js";import"./motion-C1G3s-Hn.js";import"./vendor-fCM-a2-c.js";const G=.95;function W({nations:n,playerNation:_,diplomacyOrganizations:O,overseasInvestments:T,classWealth:y,market:A,epoch:v,daysElapsed:C}){var o,E,p;const R=["capitalist","merchant","artisan","peasant","lumberjack"],t=((E=(o=L)==null?void 0:o.controlMeasures)==null?void 0:E.economicAid)||{},f=t.investmentFocusChance||0,F=t.investmentChanceMultiplier||1,I=e=>{var g;if(!e||e.id==="player")return!1;const i=e.suzerainId==="player"||e.vassalOf==="player",c=D(e,"investment_pact",C),l=D(e,"economic_pact",C),a=((g=O==null?void 0:O.organizations)==null?void 0:g.some(d=>{var r,M;return d.type==="investment_pact"&&((r=d.members)==null?void 0:r.includes("player"))&&((M=d.members)==null?void 0:M.includes(e.id))}))||!1,u=i||c||l||a;return console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥ç›®æ ‡ ${e.name}: isVassal=${i}, hasInvestmentPact=${c}, hasEconomicPact=${l}, hasOrgPact=${a} => ${u}`),u},b=e=>{var c,l;if(!e||e.vassalOf!=="player")return!1;const i=(l=(c=e.vassalPolicy)==null?void 0:c.controlMeasures)==null?void 0:l.economicAid;return i===!0||i&&i.active!==!1},s=[...R].sort(()=>Math.random()-.5);console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥æŠ•èµ„è€…é˜¶å±‚: ${s.join(", ")}`),console.log("ðŸ¤– [AUTO-INVEST] é˜¶å±‚è´¢å¯Œ:",y);for(const e of s){const i=y[e]||0;if(i<1e3){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œä¸è¶³ (${i} < 1000), è·³è¿‡`);continue}console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œ=${i}, å¼€å§‹å¯»æ‰¾æŠ•èµ„ç›®æ ‡...`),console.log(`ðŸ¤– [AUTO-INVEST] nations åˆ—è¡¨: ${(n==null?void 0:n.length)||0} ä¸ª, å›½å®¶: ${(n==null?void 0:n.map(r=>r.name).join(", "))||"æ— "}`);const c=n.filter(r=>I(r));if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ‰¾åˆ° ${c.length} ä¸ªæœ‰æ•ˆæŠ•èµ„ç›®æ ‡`),c.length===0)continue;const l=c.filter(b),a=l.length>0&&f>0&&Math.random()<f,u=a?l:c;a&&console.log(`ðŸ¤– [AUTO-INVEST] ${e} ç»æµŽæ‰¶æŒä¼˜å…ˆç›®æ ‡: ${l.map(r=>r.name).join(", ")}`);const g=new Set(l.map(r=>r.id)),d=[...u].sort(()=>Math.random()-.5);for(const r of d){const M=q("treaty",e,v);if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} å¯æŠ•èµ„çš„å»ºç­‘: ${M.map(m=>m.name).join(", ")||"æ— "}`),M.length===0)continue;const x=M.sort(()=>Math.random()-.5);for(const m of x){const S=((p=m.cost)==null?void 0:p.silver)||0;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ£€æŸ¥ ${m.name}: cost=${S}, wealth=${i.toFixed(0)}, canAfford=${i>=S}`),i<S){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è·³è¿‡ ${m.name}: è´¢å¯Œä¸è¶³`);continue}const V={buildingId:m.id,strategy:"PROFIT_MAX"},$=H(V,r,{[m.id]:0},(A==null?void 0:A.prices)||{}).profit||0,N=$*360/S;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} è¯„ä¼° ${m.name} åœ¨ ${r.name}: profit=${$.toFixed(1)}/day, ROI=${(N*100).toFixed(1)}%, threshold=${(.15*100).toFixed(1)}%`),N>.15){const w=g.has(r.id)?Math.min(1,.3*F):.3,B=Math.random();if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} ROIè¶³å¤Ÿ! roll=${B.toFixed(3)}, threshold=${w}, willInvest=${B<=w}`),B>w){console.log(`ðŸ¤– [AUTO-INVEST] ${e} éšæœºè·³è¿‡æŠ•èµ„ (${(w*100).toFixed(0)}%æ¦‚çŽ‡)`);continue}return console.log(`ðŸ¤– [AUTO-INVEST] âœ… ${e} å†³å®šæŠ•èµ„ ${m.name} åœ¨ ${r.name}!`),{success:!0,stratum:e,targetNation:r,building:m,cost:S,annualROI:N,dailyProfit:$,action:()=>X({buildingId:m.id,targetNationId:r.id,ownerStratum:e,investmentAmount:S})}}}}}return null}function z({investorNation:n,nations:_,diplomacyOrganizations:O,playerState:T,market:y,epoch:A,daysElapsed:v,foreignInvestments:C=[]}){var b;const R=s=>{var c;if(!s)return!1;const o=s.id,E=n.vassalOf===o&&n.vassalType!=="colony",p=s.vassalOf===n.id,e=(c=O==null?void 0:O.organizations)==null?void 0:c.some(l=>l.type==="economic_pact"&&l.members.includes(n.id)&&l.members.includes(o)),i=D(n,"investment_pact",v);return E||p||e||i};if(A<2||(n.wealth||0)<5e3)return null;const j=[],P=n.relation||0;if(P>30&&R(T)){const s=Math.max(.1,(P-30)/70);Math.random()<s&&j.push({id:"player",name:"Player",...T})}if(j.length===0)return null;const t=((b=n.vassalPolicy)==null?void 0:b.investmentPolicy)||"autonomous";let f=.1;t==="guided"?f=.05:t==="forced"&&(f=-.1);const I=J.filter(s=>{if(s.cat!=="gather"&&s.cat!=="industry"||(s.epoch||0)>A||!s.baseCost&&!s.cost)return!1;const o=s.jobs||{};return Object.keys(o).some(p=>p!==s.owner)}).sort(()=>Math.random()-.5);for(const s of j)for(const o of I){const E=o.baseCost||o.cost||{},e=(Object.values(E).reduce((h,$)=>h+(typeof $=="number"?$:0),0)||1e3)*1.5;if((n.wealth||0)<e)continue;const c=(s.buildings||{})[o.id]||0;if(c<=0||(C||[]).filter(h=>h.buildingId===o.id&&h.status==="operating").length>=c)continue;const u=(s.jobFill||{})[o.id]||{},g=o.jobs||{};let d=0,r=0;if(Object.entries(g).forEach(([h,$])=>{const N=$*buildingCount;d+=N,r+=Math.min(u[h]||0,N)}),(d>0?r/d:1)<G)continue;const x={};Object.keys(U).forEach(h=>{var $;x[h]=s.id==="player"&&(($=y==null?void 0:y.prices)!=null&&$[h])?y.prices[h]:U[h].basePrice||1});const S=H({buildingId:o.id,strategy:"PROFIT_MAX"},s,{},x).profit||0,V=e>0?S*360/e:0;if(console.log(`[AIæŠ•èµ„] ${n.name} è¯„ä¼° ${o.name} (Policy: ${t}): ROI=${(V*100).toFixed(1)}%, Threshold=${(f*100).toFixed(1)}%`),V>f)return console.log(`[AIæŠ•èµ„] ${n.name} å†³å®šæŠ•èµ„ ${o.name}! ROI=${(V*100).toFixed(1)}%`),{type:"request_investment",investorNation:n,targetId:s.id,building:o,cost:e,roi:V,investmentPolicy:t,action:()=>({type:"event",eventData:{nationId:n.id,opportunity:{buildingType:o.name,buildingId:o.id,potentialProfit:S*30,requiredInvestment:e,ownerStratum:"capitalist",investmentPolicy:t}}})}}return null}function k({targetBuildings:n={},targetJobFill:_={},epoch:O=0,market:T=null,investorWealth:y=1/0,foreignInvestments:A=[]}){const v=J.filter(t=>{if(t.cat!=="gather"&&t.cat!=="industry"||(t.epoch||0)>O||!t.baseCost&&!t.cost)return!1;const f=t.jobs||{};if(!Object.keys(f).some(e=>e!==t.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${t.owner}, jobs=${Object.keys(f).join(",")})`),!1;const I=n[t.id]||0;if(I<=0)return!1;const b=(A||[]).filter(e=>e.buildingId===t.id&&e.status==="operating").length;if(b>=I)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${b}/${I})`),!1;if(_&&Object.keys(_).length>0){const e=_[t.id]||{},i=t.jobs||{};let c=0,l=0;Object.entries(i).forEach(([u,g])=>{const d=g*I;c+=d,l+=Math.min(e[u]||0,d)});const a=c>0?l/c:1;if(a<G)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: åˆ°å²—çŽ‡ä¸è¶³ (${(a*100).toFixed(1)}% < 95%)`),!1}const o=t.baseCost||t.cost||{};return!((Object.values(o).reduce((e,i)=>e+(typeof i=="number"?i:0),0)||1e3)*1.5>y)});if(v.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${v.length} ä¸ªå€™é€‰å»ºç­‘: ${v.map(t=>t.name).join(", ")}`);let C=null,R=-1/0,j=0;const P={};Object.keys(U).forEach(t=>{var f,F;P[t]=((f=T==null?void 0:T.prices)==null?void 0:f[t])||((F=U[t])==null?void 0:F.basePrice)||1});for(const t of v){const f=t.baseCost||t.cost||{},I=(Object.values(f).reduce((a,u)=>a+(typeof u=="number"?u:0),0)||1e3)*1.5;let b=0;const s=t.output||{};Object.entries(s).forEach(([a,u])=>{if(a==="maxPop"||a==="militaryCapacity")return;const g=P[a]||1;b+=u*g});let o=0;const E=t.input||{};Object.entries(E).forEach(([a,u])=>{const g=P[a]||1;o+=u*g});let p=0;const e=t.jobs||{},i=(T==null?void 0:T.wages)||{};Object.entries(e).forEach(([a,u])=>{var d;if(t.owner&&a===t.owner)return;const g=(d=i[a])!=null?d:.1;p+=u*g});const c=b-o-p,l=I>0?c*360/I:0;console.log(`[æŠ•èµ„ç­›é€‰] ${t.name}: profit=${c.toFixed(1)}/day, cost=${I}, ROI=${(l*100).toFixed(1)}%`),l>R&&(R=l,C=t,j=I)}return C?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${C.name} (ROI=${(R*100).toFixed(1)}%)`),{building:C,cost:j,roi:R}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{z as processAIInvestment,W as processClassAutonomousInvestment,k as selectBestInvestmentBuilding};
