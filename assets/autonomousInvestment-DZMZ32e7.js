import{I as L,g as q,c as H,a as X,B as J,R as w,h as D}from"./index-DEBdUd2v.js";import"./motion-C1G3s-Hn.js";import"./vendor-fCM-a2-c.js";const G=.95;function k({nations:l,playerNation:N,diplomacyOrganizations:T,overseasInvestments:v,classWealth:_,market:O,epoch:y,daysElapsed:b}){var n,$,I;const C=["capitalist","merchant","artisan","peasant","lumberjack"],e=(($=(n=L)==null?void 0:n.controlMeasures)==null?void 0:$.economicAid)||{},u=e.investmentFocusChance||0,P=e.investmentChanceMultiplier||1,f=t=>{var S;if(!t||t.id==="player")return!1;const i=t.suzerainId==="player"||t.vassalOf==="player",c=D(t,"investment_pact",b),o=D(t,"economic_pact",b),r=((S=T==null?void 0:T.organizations)==null?void 0:S.some(m=>{var a,F;return m.type==="investment_pact"&&((a=m.members)==null?void 0:a.includes("player"))&&((F=m.members)==null?void 0:F.includes(t.id))}))||!1,d=i||c||o||r;return console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥ç›®æ ‡ ${t.name}: isVassal=${i}, hasInvestmentPact=${c}, hasEconomicPact=${o}, hasOrgPact=${r} => ${d}`),d},h=t=>{var c,o;if(!t||t.vassalOf!=="player")return!1;const i=(o=(c=t.vassalPolicy)==null?void 0:c.controlMeasures)==null?void 0:o.economicAid;return i===!0||i&&i.active!==!1},s=[...C].sort(()=>Math.random()-.5);console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥æŠ•èµ„è€…é˜¶å±‚: ${s.join(", ")}`),console.log("ðŸ¤– [AUTO-INVEST] é˜¶å±‚è´¢å¯Œ:",_);for(const t of s){const i=_[t]||0;if(i<1e3){console.log(`ðŸ¤– [AUTO-INVEST] ${t} è´¢å¯Œä¸è¶³ (${i} < 1000), è·³è¿‡`);continue}console.log(`ðŸ¤– [AUTO-INVEST] ${t} è´¢å¯Œ=${i}, å¼€å§‹å¯»æ‰¾æŠ•èµ„ç›®æ ‡...`),console.log(`ðŸ¤– [AUTO-INVEST] nations åˆ—è¡¨: ${(l==null?void 0:l.length)||0} ä¸ª, å›½å®¶: ${(l==null?void 0:l.map(a=>a.name).join(", "))||"æ— "}`);const c=l.filter(a=>f(a));if(console.log(`ðŸ¤– [AUTO-INVEST] ${t} æ‰¾åˆ° ${c.length} ä¸ªæœ‰æ•ˆæŠ•èµ„ç›®æ ‡`),c.length===0)continue;const o=c.filter(h),r=o.length>0&&u>0&&Math.random()<u,d=r?o:c;r&&console.log(`ðŸ¤– [AUTO-INVEST] ${t} ç»æµŽæ‰¶æŒä¼˜å…ˆç›®æ ‡: ${o.map(a=>a.name).join(", ")}`);const S=new Set(o.map(a=>a.id)),m=[...d].sort(()=>Math.random()-.5);for(const a of m){const F=q("treaty",t,y);if(console.log(`ðŸ¤– [AUTO-INVEST] ${t} å¯æŠ•èµ„çš„å»ºç­‘: ${F.map(g=>g.name).join(", ")||"æ— "}`),F.length===0)continue;const x=F.sort(()=>Math.random()-.5);for(const g of x){const E=((I=g.cost)==null?void 0:I.silver)||0;if(console.log(`ðŸ¤– [AUTO-INVEST] ${t} æ£€æŸ¥ ${g.name}: cost=${E}, wealth=${i.toFixed(0)}, canAfford=${i>=E}`),i<E){console.log(`ðŸ¤– [AUTO-INVEST] ${t} è·³è¿‡ ${g.name}: è´¢å¯Œä¸è¶³`);continue}const M={buildingId:g.id,strategy:"PROFIT_MAX"},A=H(M,a,{[g.id]:0},(O==null?void 0:O.prices)||{}).profit||0,V=A*360/E;if(console.log(`ðŸ¤– [AUTO-INVEST] ${t} è¯„ä¼° ${g.name} åœ¨ ${a.name}: profit=${A.toFixed(1)}/day, ROI=${(V*100).toFixed(1)}%, threshold=${(.15*100).toFixed(1)}%`),V>.15){const U=S.has(a.id)?Math.min(1,.3*P):.3,B=Math.random();if(console.log(`ðŸ¤– [AUTO-INVEST] ${t} ROIè¶³å¤Ÿ! roll=${B.toFixed(3)}, threshold=${U}, willInvest=${B<=U}`),B>U){console.log(`ðŸ¤– [AUTO-INVEST] ${t} éšæœºè·³è¿‡æŠ•èµ„ (${(U*100).toFixed(0)}%æ¦‚çŽ‡)`);continue}return console.log(`ðŸ¤– [AUTO-INVEST] âœ… ${t} å†³å®šæŠ•èµ„ ${g.name} åœ¨ ${a.name}!`),{success:!0,stratum:t,targetNation:a,building:g,cost:E,annualROI:V,dailyProfit:A,action:()=>X({buildingId:g.id,targetNationId:a.id,ownerStratum:t,investmentAmount:E})}}}}}return null}function W({investorNation:l,nations:N,diplomacyOrganizations:T,playerState:v,market:_,epoch:O,daysElapsed:y,foreignInvestments:b=[]}){var h;const C=s=>{var c;if(!s)return!1;const n=s.id,$=l.vassalOf===n&&l.vassalType!=="colony",I=s.vassalOf===l.id,t=(c=T==null?void 0:T.organizations)==null?void 0:c.some(o=>o.type==="economic_pact"&&o.members.includes(l.id)&&o.members.includes(n)),i=D(l,"investment_pact",y);return $||I||t||i};if(O<2||(l.wealth||0)<5e3)return null;const R=[],j=l.relation||0;if(j>30&&C(v)){const s=Math.max(.1,(j-30)/70);Math.random()<s&&R.push({id:"player",name:"Player",...v})}if(R.length===0)return null;const e=((h=l.vassalPolicy)==null?void 0:h.investmentPolicy)||"autonomous";let u=.1;e==="guided"?u=.05:e==="forced"&&(u=-.1);const f=J.filter(s=>{if(s.cat!=="gather"&&s.cat!=="industry"||(s.epoch||0)>O||!s.baseCost&&!s.cost)return!1;const n=s.jobs||{};return Object.keys(n).some(I=>I!==s.owner)}).sort(()=>Math.random()-.5);for(const s of R)for(const n of f){const $=n.baseCost||n.cost||{},t=(Object.values($).reduce((p,A)=>p+(typeof A=="number"?A:0),0)||1e3)*1.5;if((l.wealth||0)<t)continue;const c=(s.buildings||{})[n.id]||0;if(c<=0||(b||[]).filter(p=>p.buildingId===n.id&&p.status==="operating").length>=c)continue;const d=(s.jobFill||{})[n.id]||{},S=n.jobs||{};let m=0,a=0;if(Object.entries(S).forEach(([p,A])=>{const V=A*buildingCount;m+=V,a+=Math.min(d[p]||0,V)}),(m>0?a/m:1)<G)continue;const x={};Object.keys(w).forEach(p=>{x[p]=w[p].basePrice||1});const E=H({buildingId:n.id,strategy:"PROFIT_MAX"},s,{},x).profit||0,M=t>0?E*360/t:0;if(console.log(`[AIæŠ•èµ„] ${l.name} è¯„ä¼° ${n.name} (Policy: ${e}): ROI=${(M*100).toFixed(1)}%, Threshold=${(u*100).toFixed(1)}%`),M>u)return console.log(`[AIæŠ•èµ„] ${l.name} å†³å®šæŠ•èµ„ ${n.name}! ROI=${(M*100).toFixed(1)}%`),{type:"request_investment",investorNation:l,targetId:s.id,building:n,cost:t,roi:M,investmentPolicy:e,action:()=>({type:"event",eventData:{nationId:l.id,opportunity:{buildingType:n.name,buildingId:n.id,potentialProfit:E*30,requiredInvestment:t,ownerStratum:"capitalist",investmentPolicy:e}}})}}return null}function z({targetBuildings:l={},targetJobFill:N={},epoch:T=0,market:v=null,investorWealth:_=1/0,foreignInvestments:O=[]}){const y=J.filter(e=>{if(e.cat!=="gather"&&e.cat!=="industry"||(e.epoch||0)>T||!e.baseCost&&!e.cost)return!1;const u=e.jobs||{};if(!Object.keys(u).some(t=>t!==e.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${e.owner}, jobs=${Object.keys(u).join(",")})`),!1;const f=l[e.id]||0;if(f<=0)return!1;const h=(O||[]).filter(t=>t.buildingId===e.id&&t.status==="operating").length;if(h>=f)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${h}/${f})`),!1;if(N&&Object.keys(N).length>0){const t=N[e.id]||{},i=e.jobs||{};let c=0,o=0;Object.entries(i).forEach(([d,S])=>{const m=S*f;c+=m,o+=Math.min(t[d]||0,m)});const r=c>0?o/c:1;if(r<G)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: åˆ°å²—çŽ‡ä¸è¶³ (${(r*100).toFixed(1)}% < 95%)`),!1}const n=e.baseCost||e.cost||{};return!((Object.values(n).reduce((t,i)=>t+(typeof i=="number"?i:0),0)||1e3)*1.5>_)});if(y.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${y.length} ä¸ªå€™é€‰å»ºç­‘: ${y.map(e=>e.name).join(", ")}`);let b=null,C=-1/0,R=0;const j={};Object.keys(w).forEach(e=>{var u,P;j[e]=((u=v==null?void 0:v.prices)==null?void 0:u[e])||((P=w[e])==null?void 0:P.basePrice)||1});for(const e of y){const u=e.baseCost||e.cost||{},f=(Object.values(u).reduce((o,r)=>o+(typeof r=="number"?r:0),0)||1e3)*1.5;let h=0;const s=e.output||{};Object.entries(s).forEach(([o,r])=>{if(o==="maxPop"||o==="militaryCapacity")return;const d=j[o]||1;h+=r*d});let n=0;const $=e.input||{};Object.entries($).forEach(([o,r])=>{const d=j[o]||1;n+=r*d});let I=0;const t=e.jobs||{};Object.entries(t).forEach(([o,r])=>{e.owner&&o===e.owner||(I+=r*10)});const i=h-n-I,c=f>0?i*360/f:0;console.log(`[æŠ•èµ„ç­›é€‰] ${e.name}: profit=${i.toFixed(1)}/day, cost=${f}, ROI=${(c*100).toFixed(1)}%`),c>C&&(C=c,b=e,R=f)}return b?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${b.name} (ROI=${(C*100).toFixed(1)}%)`),{building:b,cost:R,roi:C}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{W as processAIInvestment,k as processClassAutonomousInvestment,z as selectBestInvestmentBuilding};
