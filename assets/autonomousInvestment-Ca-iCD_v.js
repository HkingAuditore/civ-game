import{c as D,B as V,R,h as w,g as X,a as G}from"./index-Cz543Csz.js";import"./motion-CXax0Jcm.js";import"./vendor-7s51MWtJ.js";const J=.95,B=5,_=5,L=5,F=(t,s,o)=>Math.max(s,Math.min(o,t)),S=(t,s,o)=>{if(t.length<=o)return t;const n=t.map(c=>{const u=Math.max(1e-4,s(c)),f=Math.pow(Math.random(),1/u);return{item:c,key:f}});return n.sort((c,u)=>u.key-c.key),n.slice(0,o).map(c=>c.item)},U=(t,s)=>{if(t.length<=s)return t;const o=[...t];for(let n=o.length-1;n>0;n-=1){const c=Math.floor(Math.random()*(n+1));[o[n],o[c]]=[o[c],o[n]]}return o.slice(0,s)},T=(t=0)=>F((t+100)/200,.05,1),A=t=>{const s=(t==null?void 0:t.gdp)||(t==null?void 0:t.wealth)||0;return F(Math.log10(s+1)/6,.05,1)},W=(t,s,o=30)=>{if(!Number.isFinite(s))return 1;const n=t-s;return n>=o?1:F(n/o,.2,.8)},N=(t,s,o)=>{var v,d;if(!t||t.id==="player")return!1;const n=t.suzerainId==="player"||t.vassalOf==="player",c=w(t,"investment_pact",o),u=w(t,"economic_pact",o),f=String(t.id),m=((v=s==null?void 0:s.organizations)==null?void 0:v.some(e=>{var a,i;return e.type==="economic_bloc"&&e.isActive!==!1&&((a=e.members)==null?void 0:a.some(l=>String(l)==="player"||String(l)==="0"))&&((i=e.members)==null?void 0:i.some(l=>String(l)===f))}))||!1,b=n||c||u||m;return b||console.log(`ðŸ¤– [INVEST-CHECK] ${t.name} ä¸å¯æŠ•èµ„: isVassal=${n}, hasInvestmentPact=${c}, hasEconomicPact=${u}, hasOrgEconomicBloc=${m}, treaties=${JSON.stringify((d=t.treaties)==null?void 0:d.slice(0,2))}`),b},H=(t,s,o,n)=>{var d;if(!t||!s)return!1;const c=s.id||"player",u=t.vassalOf===c&&t.vassalType!=="colony",f=s.vassalOf===t.id,m=(d=o==null?void 0:o.organizations)==null?void 0:d.some(e=>{var a,i;return e.type==="economic_bloc"&&((a=e.members)==null?void 0:a.includes(t.id))&&((i=e.members)==null?void 0:i.includes(c))}),b=w(t,"investment_pact",n),v=w(t,"economic_pact",n);return u||f||m||b||v},K=(t="autonomous")=>t==="guided"?.05:t==="forced"?-.1:.1,q=(t,s,o)=>{const n={};return o.forEach(c=>{n[c]=X(s,c,t)}),n},x=t=>{const s=(t==null?void 0:t.cost)||(t==null?void 0:t.baseCost)||{};return Object.values(s).reduce((n,c)=>n+c,0)*1.5},Q=(t,s,o)=>{const n=x(t);if(n<=0)return{roi:-1/0,dailyProfit:0};const c={buildingId:t.id,strategy:"PROFIT_MAX"},f=G(c,s,{},(o==null?void 0:o.prices)||{}).profit||0;return{roi:f*360/n,dailyProfit:f}};function tt({nations:t,playerNation:s,diplomacyOrganizations:o,overseasInvestments:n,classWealth:c,market:u,epoch:f,daysElapsed:m,maxNations:b=B,maxInvestments:v=_}){if(!s)return[];const d=(t||[]).filter(r=>N(r,o,m));if(d.length===0)return[];const a=S(d,r=>{const O=T(r.relation||0),$=A(r),P=W(m,r.lastOutboundSampleDay,30);return O*$*P},Math.min(b,d.length)),i=Object.keys(c||{}).filter(r=>(c[r]||0)>=1e3);if(i.length===0)return[];const l=[];return a.forEach(r=>{const O=r.vassalOf==="player"?"vassal":"treaty",$=q(f,O,i);let P=null;i.forEach(g=>{const E=c[g]||0,M=$[g]||[];U(M,L).forEach(h=>{const I=x(h);if(I<=0||I>E)return;const{roi:C,dailyProfit:y}=Q(h,r,u);!Number.isFinite(C)||C<=0||(!P||C>P.roi)&&(P={stratum:g,targetNation:r,building:h,cost:I,roi:C,dailyProfit:y})})}),P&&l.push(P)}),l.length===0?[]:(l.sort((r,O)=>O.roi-r.roi),l.slice(0,Math.min(v,l.length)).map(r=>({...r,investment:D({buildingId:r.building.id,targetNationId:r.targetNation.id,ownerStratum:r.stratum,strategy:"PROFIT_MAX",investmentAmount:r.cost})})))}function et({investorNations:t,playerState:s,diplomacyOrganizations:o,market:n,epoch:c,daysElapsed:u,foreignInvestments:f=[],maxNations:m=B,maxInvestments:b=_}){const v=(t||[]).filter(i=>{var p;if(!i||i.id==="player"||(i.wealth||0)<5e3||!H(i,s,o,u))return!1;const l=(p=i.lastForeignInvestmentDay)!=null?p:-1/0;return u-l>=60});if(v.length===0)return[];const e=S(v,i=>{const l=T(i.relation||0),p=A(i),r=W(u,i.lastForeignSampleDay,30);return l*p*r},Math.min(m,v.length)),a=[];return e.forEach(i=>{var O;const l=((O=i.vassalPolicy)==null?void 0:O.investmentPolicy)||"autonomous",p=K(l),r=Y({targetBuildings:(s==null?void 0:s.buildings)||{},targetJobFill:(s==null?void 0:s.jobFill)||{},epoch:c,market:n,investorWealth:i.wealth||0,foreignInvestments:f});!r||r.roi<=p||a.push({investorNation:i,building:r.building,cost:r.cost,roi:r.roi,investmentPolicy:l})}),a.length===0?[]:(a.sort((i,l)=>l.roi-i.roi),a.slice(0,Math.min(b,a.length)))}function Y({targetBuildings:t={},targetJobFill:s={},epoch:o=0,market:n=null,investorWealth:c=1/0,foreignInvestments:u=[]}){const f=V.filter(e=>{if(e.cat!=="gather"&&e.cat!=="industry"||(e.epoch||0)>o||!e.baseCost&&!e.cost)return!1;const a=e.jobs||{};if(!Object.keys(a).some(g=>g!==e.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${e.owner}, jobs=${Object.keys(a).join(",")})`),!1;const l=t[e.id]||0;if(l<=0)return!1;const p=(u||[]).filter(g=>g.buildingId===e.id&&g.status==="operating").reduce((g,E)=>g+(E.count||1),0);if(p>=l)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${p}/${l})`),!1;if(s&&Object.keys(s).length>0){const g=s[e.id]||{},E=e.jobs||{};let M=0,j=0;Object.entries(E).forEach(([I,C])=>{const y=C*l;M+=y,j+=Math.min(g[I]||0,y)});const h=M>0?j/M:1;if(h<J)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${e.name}: åˆ°å²—çŽ‡ä¸è¶³ (${(h*100).toFixed(1)}% < 95%)`),!1}const O=e.baseCost||e.cost||{};return!((Object.values(O).reduce((g,E)=>g+(typeof E=="number"?E:0),0)||1e3)*1.5>c)});if(f.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${f.length} ä¸ªå€™é€‰å»ºç­‘: ${f.map(e=>e.name).join(", ")}`);let m=null,b=-1/0,v=0;const d={};Object.keys(R).forEach(e=>{var a,i;d[e]=((a=n==null?void 0:n.prices)==null?void 0:a[e])||((i=R[e])==null?void 0:i.basePrice)||1});for(const e of f){const a=e.baseCost||e.cost||{},l=(Object.values(a).reduce((h,I)=>h+(typeof I=="number"?I:0),0)||1e3)*1.5;let p=0;const r=e.output||{};Object.entries(r).forEach(([h,I])=>{if(h==="maxPop"||h==="militaryCapacity")return;const C=d[h]||1;p+=I*C});let O=0;const $=e.input||{};Object.entries($).forEach(([h,I])=>{const C=d[h]||1;O+=I*C});let P=0;const g=e.jobs||{},E=(n==null?void 0:n.wages)||{};Object.entries(g).forEach(([h,I])=>{var y;if(e.owner&&h===e.owner)return;const C=(y=E[h])!=null?y:.1;P+=I*C});const M=p-O-P,j=l>0?M*360/l:0;console.log(`[æŠ•èµ„ç­›é€‰] ${e.name}: profit=${M.toFixed(1)}/day, cost=${l}, ROI=${(j*100).toFixed(1)}%`),j>b&&(b=j,m=e,v=l)}return m?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${m.name} (ROI=${(b*100).toFixed(1)}%)`),{building:m,cost:v,roi:b}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{Y as selectBestInvestmentBuilding,et as selectInboundInvestmentsBatch,tt as selectOutboundInvestmentsBatch};
