import{I as L,g as q,c as H,a as X,B as J,R as B,h as U}from"./index-DlbB78Nu.js";import"./motion-CXax0Jcm.js";import"./vendor-7s51MWtJ.js";const G=.95;function W({nations:s,playerNation:N,diplomacyOrganizations:O,overseasInvestments:b,classWealth:S,market:R,epoch:C,daysElapsed:y}){var o,p,I;const v=["capitalist","merchant","artisan","peasant","lumberjack"],t=((p=(o=L)==null?void 0:o.controlMeasures)==null?void 0:p.economicAid)||{},f=t.investmentFocusChance||0,F=t.investmentChanceMultiplier||1,m=e=>{var g;if(!e||e.id==="player")return!1;const c=e.suzerainId==="player"||e.vassalOf==="player",i=U(e,"investment_pact",y),a=U(e,"economic_pact",y),l=((g=O==null?void 0:O.organizations)==null?void 0:g.some(d=>{var u,M;return d.type==="economic_bloc"&&((u=d.members)==null?void 0:u.includes("player"))&&((M=d.members)==null?void 0:M.includes(e.id))}))||!1,r=c||i||a||l;return console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥ç›®æ ‡ ${e.name}: isVassal=${c}, hasInvestmentPact=${i}, hasEconomicPact=${a}, hasOrgEconomicBloc=${l} => ${r}`),r},E=e=>{var i,a;if(!e||e.vassalOf!=="player")return!1;const c=(a=(i=e.vassalPolicy)==null?void 0:i.controlMeasures)==null?void 0:a.economicAid;return c===!0||c&&c.active!==!1},n=[...v].sort(()=>Math.random()-.5);console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥æŠ•èµ„è€…é˜¶å±‚: ${n.join(", ")}`),console.log("ðŸ¤– [AUTO-INVEST] é˜¶å±‚è´¢å¯Œ:",S);for(const e of n){const c=S[e]||0;if(c<1e3){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œä¸è¶³ (${c} < 1000), è·³è¿‡`);continue}console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œ=${c}, å¼€å§‹å¯»æ‰¾æŠ•èµ„ç›®æ ‡...`),console.log(`ðŸ¤– [AUTO-INVEST] nations åˆ—è¡¨: ${(s==null?void 0:s.length)||0} ä¸ª, å›½å®¶: ${(s==null?void 0:s.map(u=>u.name).join(", "))||"æ— "}`);const i=s.filter(u=>m(u));if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ‰¾åˆ° ${i.length} ä¸ªæœ‰æ•ˆæŠ•èµ„ç›®æ ‡`),i.length===0)continue;const a=i.filter(E),l=a.length>0&&f>0&&Math.random()<f,r=l?a:i;l&&console.log(`ðŸ¤– [AUTO-INVEST] ${e} ç»æµŽæ‰¶æŒä¼˜å…ˆç›®æ ‡: ${a.map(u=>u.name).join(", ")}`);const g=new Set(a.map(u=>u.id)),d=[...r].sort(()=>Math.random()-.5);for(const u of d){const M=q("treaty",e,C);if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} å¯æŠ•èµ„çš„å»ºç­‘: ${M.map(h=>h.name).join(", ")||"æ— "}`),M.length===0)continue;const x=M.sort(()=>Math.random()-.5);for(const h of x){const A=((I=h.cost)==null?void 0:I.silver)||0;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ£€æŸ¥ ${h.name}: cost=${A}, wealth=${c.toFixed(0)}, canAfford=${c>=A}`),c<A){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è·³è¿‡ ${h.name}: è´¢å¯Œä¸è¶³`);continue}const V={buildingId:h.id,strategy:"PROFIT_MAX"},T=H(V,u,{[h.id]:0},(R==null?void 0:R.prices)||{}).profit||0,_=T*360/A;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} è¯„ä¼° ${h.name} åœ¨ ${u.name}: profit=${T.toFixed(1)}/day, ROI=${(_*100).toFixed(1)}%, threshold=${(.15*100).toFixed(1)}%`),_>.15){const w=g.has(u.id)?Math.min(1,.3*F):.3,D=Math.random();if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} ROIè¶³å¤Ÿ! roll=${D.toFixed(3)}, threshold=${w}, willInvest=${D<=w}`),D>w){console.log(`ðŸ¤– [AUTO-INVEST] ${e} éšæœºè·³è¿‡æŠ•èµ„ (${(w*100).toFixed(0)}%æ¦‚çŽ‡)`);continue}return console.log(`ðŸ¤– [AUTO-INVEST] âœ… ${e} å†³å®šæŠ•èµ„ ${h.name} åœ¨ ${u.name}!`),{success:!0,stratum:e,targetNation:u,building:h,cost:A,annualROI:_,dailyProfit:T,action:()=>X({buildingId:h.id,targetNationId:u.id,ownerStratum:e,investmentAmount:A})}}}}}return null}function z({investorNation:s,nations:N,diplomacyOrganizations:O,playerState:b,market:S,epoch:R,daysElapsed:C,foreignInvestments:y=[]}){var E;const v=n=>{var l;if(!n)return!1;const o=n.id,p=s.vassalOf===o&&s.vassalType!=="colony",I=n.vassalOf===s.id,e=(l=O==null?void 0:O.organizations)==null?void 0:l.some(r=>r.type==="economic_bloc"&&r.members.includes(s.id)&&r.members.includes(o)),c=U(s,"investment_pact",C),i=U(s,"economic_pact",C),a=p||I||e||c||i;return console.log(`[AIæŠ•èµ„æ£€æŸ¥] ${s.name} -> ${o}: isVassal=${p}, isSuzerain=${I}, hasEconomicOrg=${e}, hasInvestmentPact=${c}, hasEconomicPact=${i} => ${a}`),a};if(R<2||(s.wealth||0)<5e3)return null;const j=[],P=s.relation||0;if(P>30&&v(b)){const n=Math.max(.1,(P-30)/70);Math.random()<n&&j.push({id:"player",name:"Player",...b})}if(j.length===0)return null;const t=((E=s.vassalPolicy)==null?void 0:E.investmentPolicy)||"autonomous";let f=.1;t==="guided"?f=.05:t==="forced"&&(f=-.1);const m=J.filter(n=>{if(n.cat!=="gather"&&n.cat!=="industry"||(n.epoch||0)>R||!n.baseCost&&!n.cost)return!1;const o=n.jobs||{};return Object.keys(o).some(I=>I!==n.owner)}).sort(()=>Math.random()-.5);for(const n of j)for(const o of m){const p=o.baseCost||o.cost||{},e=(Object.values(p).reduce(($,T)=>$+(typeof T=="number"?T:0),0)||1e3)*1.5;if((s.wealth||0)<e)continue;const i=(n.buildings||{})[o.id]||0;if(i<=0||(y||[]).filter($=>$.buildingId===o.id&&$.status==="operating").length>=i)continue;const r=(n.jobFill||{})[o.id]||{},g=o.jobs||{};let d=0,u=0;if(Object.entries(g).forEach(([$,T])=>{const _=T*i;d+=_,u+=Math.min(r[$]||0,_)}),(d>0?u/d:1)<G)continue;const x={};Object.keys(B).forEach($=>{var T;x[$]=n.id==="player"&&((T=S==null?void 0:S.prices)!=null&&T[$])?S.prices[$]:B[$].basePrice||1});const A=H({buildingId:o.id,strategy:"PROFIT_MAX"},n,{},x).profit||0,V=e>0?A*360/e:0;if(console.log(`[AIæŠ•èµ„] ${s.name} è¯„ä¼° ${o.name} (Policy: ${t}): ROI=${(V*100).toFixed(1)}%, Threshold=${(f*100).toFixed(1)}%`),V>f)return console.log(`[AIæŠ•èµ„] ${s.name} å†³å®šæŠ•èµ„ ${o.name}! ROI=${(V*100).toFixed(1)}%`),{type:"request_investment",investorNation:s,targetId:n.id,building:o,cost:e,roi:V,investmentPolicy:t,action:()=>({type:"event",eventData:{nationId:s.id,opportunity:{buildingType:o.name,buildingId:o.id,potentialProfit:A*30,requiredInvestment:e,ownerStratum:"capitalist",investmentPolicy:t}}})}}return null}function k({targetBuildings:s={},targetJobFill:N={},epoch:O=0,market:b=null,investorWealth:S=1/0,foreignInvestments:R=[]}){const C=J.filter(t=>{if(t.cat!=="gather"&&t.cat!=="industry"||(t.epoch||0)>O||!t.baseCost&&!t.cost)return!1;const f=t.jobs||{};if(!Object.keys(f).some(e=>e!==t.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${t.owner}, jobs=${Object.keys(f).join(",")})`),!1;const m=s[t.id]||0;if(m<=0)return!1;const E=(R||[]).filter(e=>e.buildingId===t.id&&e.status==="operating").length;if(E>=m)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${E}/${m})`),!1;if(N&&Object.keys(N).length>0){const e=N[t.id]||{},c=t.jobs||{};let i=0,a=0;Object.entries(c).forEach(([r,g])=>{const d=g*m;i+=d,a+=Math.min(e[r]||0,d)});const l=i>0?a/i:1;if(l<G)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: åˆ°å²—çŽ‡ä¸è¶³ (${(l*100).toFixed(1)}% < 95%)`),!1}const o=t.baseCost||t.cost||{};return!((Object.values(o).reduce((e,c)=>e+(typeof c=="number"?c:0),0)||1e3)*1.5>S)});if(C.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${C.length} ä¸ªå€™é€‰å»ºç­‘: ${C.map(t=>t.name).join(", ")}`);let y=null,v=-1/0,j=0;const P={};Object.keys(B).forEach(t=>{var f,F;P[t]=((f=b==null?void 0:b.prices)==null?void 0:f[t])||((F=B[t])==null?void 0:F.basePrice)||1});for(const t of C){const f=t.baseCost||t.cost||{},m=(Object.values(f).reduce((l,r)=>l+(typeof r=="number"?r:0),0)||1e3)*1.5;let E=0;const n=t.output||{};Object.entries(n).forEach(([l,r])=>{if(l==="maxPop"||l==="militaryCapacity")return;const g=P[l]||1;E+=r*g});let o=0;const p=t.input||{};Object.entries(p).forEach(([l,r])=>{const g=P[l]||1;o+=r*g});let I=0;const e=t.jobs||{},c=(b==null?void 0:b.wages)||{};Object.entries(e).forEach(([l,r])=>{var d;if(t.owner&&l===t.owner)return;const g=(d=c[l])!=null?d:.1;I+=r*g});const i=E-o-I,a=m>0?i*360/m:0;console.log(`[æŠ•èµ„ç­›é€‰] ${t.name}: profit=${i.toFixed(1)}/day, cost=${m}, ROI=${(a*100).toFixed(1)}%`),a>v&&(v=a,y=t,j=m)}return y?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${y.name} (ROI=${(v*100).toFixed(1)}%)`),{building:y,cost:j,roi:v}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{z as processAIInvestment,W as processClassAutonomousInvestment,k as selectBestInvestmentBuilding};
