import{g as H,c as U,a as D,B,R as P,h as V}from"./index-Bh41No37.js";import"./motion-C1G3s-Hn.js";import"./vendor-fCM-a2-c.js";const w=.95;function K({nations:i,playerNation:A,diplomacyOrganizations:$,overseasInvestments:y,classWealth:j,market:b,epoch:p,daysElapsed:h}){var O;const E=["capitalist","merchant","artisan","peasant","lumberjack"],t=e=>{var l;if(!e||e.id==="player")return!1;const u=e.suzerainId==="player"||e.vassalOf==="player",o=V(e,"investment_pact",h),s=V(e,"economic_pact",h),r=((l=$==null?void 0:$.organizations)==null?void 0:l.some(n=>{var c,a;return n.type==="investment_pact"&&((c=n.members)==null?void 0:c.includes("player"))&&((a=n.members)==null?void 0:a.includes(e.id))}))||!1,d=u||o||s||r;return console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥ç›®æ ‡ ${e.name}: isVassal=${u}, hasInvestmentPact=${o}, hasEconomicPact=${s}, hasOrgPact=${r} => ${d}`),d},f=[...E].sort(()=>Math.random()-.5);console.log(`ðŸ¤– [AUTO-INVEST] æ£€æŸ¥æŠ•èµ„è€…é˜¶å±‚: ${f.join(", ")}`),console.log("ðŸ¤– [AUTO-INVEST] é˜¶å±‚è´¢å¯Œ:",j);for(const e of f){const u=j[e]||0;if(u<1e3){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œä¸è¶³ (${u} < 1000), è·³è¿‡`);continue}console.log(`ðŸ¤– [AUTO-INVEST] ${e} è´¢å¯Œ=${u}, å¼€å§‹å¯»æ‰¾æŠ•èµ„ç›®æ ‡...`),console.log(`ðŸ¤– [AUTO-INVEST] nations åˆ—è¡¨: ${(i==null?void 0:i.length)||0} ä¸ª, å›½å®¶: ${(i==null?void 0:i.map(r=>r.name).join(", "))||"æ— "}`);const o=i.filter(r=>t(r));if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ‰¾åˆ° ${o.length} ä¸ªæœ‰æ•ˆæŠ•èµ„ç›®æ ‡`),o.length===0)continue;const s=[...o].sort(()=>Math.random()-.5);for(const r of s){const d=H("treaty",e,p);if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} å¯æŠ•èµ„çš„å»ºç­‘: ${d.map(n=>n.name).join(", ")||"æ— "}`),d.length===0)continue;const l=d.sort(()=>Math.random()-.5);for(const n of l){const c=((O=n.cost)==null?void 0:O.silver)||0;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} æ£€æŸ¥ ${n.name}: cost=${c}, wealth=${u.toFixed(0)}, canAfford=${u>=c}`),u<c){console.log(`ðŸ¤– [AUTO-INVEST] ${e} è·³è¿‡ ${n.name}: è´¢å¯Œä¸è¶³`);continue}const a={buildingId:n.id,strategy:"PROFIT_MAX"},I=U(a,r,{[n.id]:0},(b==null?void 0:b.prices)||{}).profit||0,R=I*360/c;if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} è¯„ä¼° ${n.name} åœ¨ ${r.name}: profit=${I.toFixed(1)}/day, ROI=${(R*100).toFixed(1)}%, threshold=${(.15*100).toFixed(1)}%`),R>.15){const m=Math.random();if(console.log(`ðŸ¤– [AUTO-INVEST] ${e} ROIè¶³å¤Ÿ! roll=${m.toFixed(3)}, threshold=${.3}, willInvest=${m<=.3}`),m>.3){console.log(`ðŸ¤– [AUTO-INVEST] ${e} éšæœºè·³è¿‡æŠ•èµ„ (${(.3*100).toFixed(0)}%æ¦‚çŽ‡)`);continue}return console.log(`ðŸ¤– [AUTO-INVEST] âœ… ${e} å†³å®šæŠ•èµ„ ${n.name} åœ¨ ${r.name}!`),{success:!0,stratum:e,targetNation:r,building:n,cost:c,annualROI:R,dailyProfit:I,action:()=>D({buildingId:n.id,targetNationId:r.id,ownerStratum:e,investmentAmount:c})}}}}}return null}function Q({investorNation:i,nations:A,diplomacyOrganizations:$,playerState:y,market:j,epoch:b,daysElapsed:p,foreignInvestments:h=[]}){var u;const E=o=>{var c;if(!o)return!1;const s=o.id,r=i.vassalOf===s&&i.vassalType!=="colony",d=o.vassalOf===i.id,l=(c=$==null?void 0:$.organizations)==null?void 0:c.some(a=>a.type==="economic_pact"&&a.members.includes(i.id)&&a.members.includes(s)),n=V(i,"investment_pact",p);return r||d||l||n};if(b<2||(i.wealth||0)<5e3)return null;const S=[],C=i.relation||0;if(C>30&&E(y)){const o=Math.max(.1,(C-30)/70);Math.random()<o&&S.push({id:"player",name:"Player",...y})}if(S.length===0)return null;const t=((u=i.vassalPolicy)==null?void 0:u.investmentPolicy)||"autonomous";let f=.1;t==="guided"?f=.05:t==="forced"&&(f=-.1);const e=B.filter(o=>{if(o.cat!=="gather"&&o.cat!=="industry"||(o.epoch||0)>b||!o.baseCost&&!o.cost)return!1;const s=o.jobs||{};return Object.keys(s).some(d=>d!==o.owner)}).sort(()=>Math.random()-.5);for(const o of S)for(const s of e){const r=s.baseCost||s.cost||{},l=(Object.values(r).reduce((T,N)=>T+(typeof N=="number"?N:0),0)||1e3)*1.5;if((i.wealth||0)<l)continue;const c=(o.buildings||{})[s.id]||0;if(c<=0||(h||[]).filter(T=>T.buildingId===s.id&&T.status==="operating").length>=c)continue;const I=(o.jobFill||{})[s.id]||{},R=s.jobs||{};let m=0,v=0;if(Object.entries(R).forEach(([T,N])=>{const x=N*buildingCount;m+=x,v+=Math.min(I[T]||0,x)}),(m>0?v/m:1)<w)continue;const _={};Object.keys(P).forEach(T=>{_[T]=P[T].basePrice||1});const M=U({buildingId:s.id,strategy:"PROFIT_MAX"},o,{},_).profit||0,F=l>0?M*360/l:0;if(console.log(`[AIæŠ•èµ„] ${i.name} è¯„ä¼° ${s.name} (Policy: ${t}): ROI=${(F*100).toFixed(1)}%, Threshold=${(f*100).toFixed(1)}%`),F>f)return console.log(`[AIæŠ•èµ„] ${i.name} å†³å®šæŠ•èµ„ ${s.name}! ROI=${(F*100).toFixed(1)}%`),{type:"request_investment",investorNation:i,targetId:o.id,building:s,cost:l,roi:F,investmentPolicy:t,action:()=>({type:"event",eventData:{nationId:i.id,opportunity:{buildingType:s.name,buildingId:s.id,potentialProfit:M*30,requiredInvestment:l,ownerStratum:"capitalist",investmentPolicy:t}}})}}return null}function Y({targetBuildings:i={},targetJobFill:A={},epoch:$=0,market:y=null,investorWealth:j=1/0,foreignInvestments:b=[]}){const p=B.filter(t=>{if(t.cat!=="gather"&&t.cat!=="industry"||(t.epoch||0)>$||!t.baseCost&&!t.cost)return!1;const f=t.jobs||{};if(!Object.keys(f).some(l=>l!==t.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${t.owner}, jobs=${Object.keys(f).join(",")})`),!1;const e=i[t.id]||0;if(e<=0)return!1;const u=(b||[]).filter(l=>l.buildingId===t.id&&l.status==="operating").length;if(u>=e)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${u}/${e})`),!1;if(A&&Object.keys(A).length>0){const l=A[t.id]||{},n=t.jobs||{};let c=0,a=0;Object.entries(n).forEach(([I,R])=>{const m=R*e;c+=m,a+=Math.min(l[I]||0,m)});const g=c>0?a/c:1;if(g<w)return console.log(`[æŠ•èµ„ç­›é€‰] æŽ’é™¤ ${t.name}: åˆ°å²—çŽ‡ä¸è¶³ (${(g*100).toFixed(1)}% < 95%)`),!1}const s=t.baseCost||t.cost||{};return!((Object.values(s).reduce((l,n)=>l+(typeof n=="number"?n:0),0)||1e3)*1.5>j)});if(p.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${p.length} ä¸ªå€™é€‰å»ºç­‘: ${p.map(t=>t.name).join(", ")}`);let h=null,E=-1/0,S=0;const C={};Object.keys(P).forEach(t=>{var f,O;C[t]=((f=y==null?void 0:y.prices)==null?void 0:f[t])||((O=P[t])==null?void 0:O.basePrice)||1});for(const t of p){const f=t.baseCost||t.cost||{},e=(Object.values(f).reduce((a,g)=>a+(typeof g=="number"?g:0),0)||1e3)*1.5;let u=0;const o=t.output||{};Object.entries(o).forEach(([a,g])=>{if(a==="maxPop"||a==="militaryCapacity")return;const I=C[a]||1;u+=g*I});let s=0;const r=t.input||{};Object.entries(r).forEach(([a,g])=>{const I=C[a]||1;s+=g*I});let d=0;const l=t.jobs||{};Object.entries(l).forEach(([a,g])=>{t.owner&&a===t.owner||(d+=g*10)});const n=u-s-d,c=e>0?n*360/e:0;console.log(`[æŠ•èµ„ç­›é€‰] ${t.name}: profit=${n.toFixed(1)}/day, cost=${e}, ROI=${(c*100).toFixed(1)}%`),c>E&&(E=c,h=t,S=e)}return h?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${h.name} (ROI=${(E*100).toFixed(1)}%)`),{building:h,cost:S,roi:E}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{Q as processAIInvestment,K as processClassAutonomousInvestment,Y as selectBestInvestmentBuilding};
