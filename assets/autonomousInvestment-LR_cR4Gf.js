import{c as T,B as A,R as $,h as j,g as V,a as X}from"./index-h6UbQl0G.js";import"./motion-CXax0Jcm.js";import"./vendor-7s51MWtJ.js";const J=.95,y=5,L=5,F=(e,t,l)=>Math.max(t,Math.min(l,e)),S=(e,t)=>{if(e.length<=t)return e;const l=[...e];for(let i=l.length-1;i>0;i-=1){const r=Math.floor(Math.random()*(i+1));[l[i],l[r]]=[l[r],l[i]]}return l.slice(0,t)},M=(e=0)=>F((e+100)/200,.05,1),P=e=>{const t=(e==null?void 0:e.gdp)||(e==null?void 0:e.wealth)||0;return F(Math.log10(t+1)/6,.05,1)},W=(e,t,l)=>{var I;if(!e||e.id==="player")return!1;const i=e.suzerainId==="player"||e.vassalOf==="player",r=j(e,"investment_pact",l),v=j(e,"economic_pact",l),B=String(e.id),U=((I=t==null?void 0:t.organizations)==null?void 0:I.some(a=>{var s,u;return a.type==="economic_bloc"&&a.isActive!==!1&&((s=a.members)==null?void 0:s.some(f=>String(f)==="player"||String(f)==="0"))&&((u=a.members)==null?void 0:u.some(f=>String(f)===B))}))||!1;return i||r||v||U},q=(e,t,l,i)=>{var a;if(!e||!t)return!1;const r=t.id||"player",v=e.vassalOf===r&&e.vassalType!=="colony",B=t.vassalOf===e.id,U=(a=l==null?void 0:l.organizations)==null?void 0:a.some(s=>{var u,f;return s.type==="economic_bloc"&&((u=s.members)==null?void 0:u.includes(e.id))&&((f=s.members)==null?void 0:f.includes(r))}),E=j(e,"investment_pact",i),I=j(e,"economic_pact",i);return v||B||U||E||I},H=(e="autonomous")=>e==="guided"?.05:e==="forced"?-.1:.1,K=(e,t,l)=>{const i={};return l.forEach(r=>{i[r]=V(t,r,e)}),i},_=e=>{const t=(e==null?void 0:e.cost)||(e==null?void 0:e.baseCost)||{};return Object.values(t).reduce((i,r)=>i+r,0)*1.5},Q=(e,t,l)=>{const i=_(e);if(i<=0)return{roi:-1/0,dailyProfit:0};const r={buildingId:e.id,strategy:"PROFIT_MAX"},B=X(r,t,{},(l==null?void 0:l.prices)||{}).profit||0;return{roi:B*360/i,dailyProfit:B}};function ee({nations:e,playerNation:t,diplomacyOrganizations:l,overseasInvestments:i,classWealth:r,market:v,epoch:B,daysElapsed:U,maxInvestments:E=y,batchSize:I=2,batchOffset:a=0}){if(!t)return{investments:[],hasMore:!1,nextOffset:0};const s=(e||[]).filter(c=>W(c,l,U));if(s.length===0)return{investments:[],hasMore:!1,nextOffset:0};const u=s.sort((c,n)=>{const d=M(c.relation||0)*P(c);return M(n.relation||0)*P(n)-d}),f=u.slice(a,a+I),g=a+I<u.length,m=g?a+I:0,G=Object.keys(r||{}).filter(c=>(r[c]||0)>=1e3);if(G.length===0)return{investments:[],hasMore:g,nextOffset:m};const o=[];return f.forEach(c=>{const n=c.vassalOf==="player"?"vassal":"treaty",d=K(B,n,G);let h=null;G.forEach(b=>{const D=r[b]||0,N=d[b]||[];S(N,L).forEach(p=>{const R=_(p);if(R<=0||R>D)return;const{roi:w,dailyProfit:x}=Q(p,c,v);!Number.isFinite(w)||w<=0||(!h||w>h.roi)&&(h={stratum:b,targetNation:c,building:p,cost:R,roi:w,dailyProfit:x})})}),h&&o.push(h)}),o.length===0?{investments:[],hasMore:g,nextOffset:m}:(o.sort((c,n)=>n.roi-c.roi),{investments:o.slice(0,Math.min(E,o.length)).map(c=>({...c,investment:T({buildingId:c.building.id,targetNationId:c.targetNation.id,ownerStratum:c.stratum,strategy:"PROFIT_MAX",investmentAmount:c.cost})})),hasMore:g,nextOffset:m})}function se({investorNations:e,playerState:t,diplomacyOrganizations:l,market:i,epoch:r,daysElapsed:v,foreignInvestments:B=[],maxInvestments:U=y,batchSize:E=2,batchOffset:I=0}){console.log("ğŸ” [INBOUND-DEBUG] å¼€å§‹ç­›é€‰æŠ•èµ„å›½..."),console.log("ğŸ” [INBOUND-DEBUG] investorNations æ•°é‡:",(e==null?void 0:e.length)||0),console.log("ğŸ” [INBOUND-DEBUG] playerState:",t==null?void 0:t.id),console.log("ğŸ” [INBOUND-DEBUG] daysElapsed:",v);const a=(e||[]).filter(o=>{var n;if(!o||o.id==="player")return console.log("ğŸ” [INBOUND-DEBUG] è·³è¿‡:",(o==null?void 0:o.name)||"null","- åŸå› : ç©å®¶æˆ–null"),!1;if((o.wealth||0)<5e3)return console.log("ğŸ” [INBOUND-DEBUG] è·³è¿‡:",o.name,"- åŸå› : è´¢å¯Œä¸è¶³",o.wealth),!1;if(!q(o,t,l,v))return console.log("ğŸ” [INBOUND-DEBUG] è·³è¿‡:",o.name,"- åŸå› : æ— æŠ•èµ„æƒé™"),!1;const O=(n=o.lastForeignInvestmentDay)!=null?n:-1/0,c=v-O;return c<60?(console.log("ğŸ” [INBOUND-DEBUG] è·³è¿‡:",o.name,"- åŸå› : å†·å´ä¸­",c,"å¤©"),!1):(console.log("âœ… [INBOUND-DEBUG] ç¬¦åˆæ¡ä»¶:",o.name,"- è´¢å¯Œ:",o.wealth,"å…³ç³»:",o.relation),!0)});if(console.log("ğŸ” [INBOUND-DEBUG] eligibleInvestors æ•°é‡:",a.length),a.length===0)return console.log("âŒ [INBOUND-DEBUG] æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æŠ•èµ„å›½"),{investments:[],hasMore:!1,nextOffset:0};const s=a.sort((o,O)=>{const c=M(o.relation||0)*P(o);return M(O.relation||0)*P(O)-c});console.log("ğŸ” [INBOUND-DEBUG] æ’åºåçš„æŠ•èµ„å›½:",s.map(o=>o.name));const u=s.slice(I,I+E),f=I+E<s.length,g=f?I+E:0;console.log("ğŸ” [INBOUND-DEBUG] æœ¬æ‰¹æ¬¡å¤„ç†:",u.map(o=>o.name)),console.log("ğŸ” [INBOUND-DEBUG] batchOffset:",I,"hasMore:",f,"nextOffset:",g);const m=[];if(u.forEach(o=>{var d,h;const O=((d=o.vassalPolicy)==null?void 0:d.investmentPolicy)||"autonomous",c=H(O);console.log("ğŸ” [INBOUND-DEBUG] è¯„ä¼°",o.name,"- policy:",O,"threshold:",c);const n=Y({targetBuildings:(t==null?void 0:t.buildings)||{},targetJobFill:(t==null?void 0:t.jobFill)||{},epoch:r,market:i,investorWealth:o.wealth||0,foreignInvestments:B});if(console.log("ğŸ” [INBOUND-DEBUG]",o.name,"æœ€ä½³å»ºç­‘:",(h=n==null?void 0:n.building)==null?void 0:h.name,"ROI:",n==null?void 0:n.roi),!n||n.roi<=c){console.log("âŒ [INBOUND-DEBUG]",o.name,"è·³è¿‡ - ROIä¸è¶³æˆ–æ— å»ºç­‘");return}console.log("âœ… [INBOUND-DEBUG]",o.name,"å†³å®šæŠ•èµ„:",n.building.name),m.push({investorNation:o,building:n.building,cost:n.cost,roi:n.roi,investmentPolicy:O})}),console.log("ğŸ” [INBOUND-DEBUG] æœ¬æ‰¹æ¬¡æŠ•èµ„å†³ç­–æ•°é‡:",m.length),m.length===0)return console.log("âŒ [INBOUND-DEBUG] æœ¬æ‰¹æ¬¡æ²¡æœ‰æŠ•èµ„å†³ç­–"),{investments:[],hasMore:f,nextOffset:g};m.sort((o,O)=>O.roi-o.roi);const G=m.slice(0,Math.min(U,m.length));return console.log("âœ… [INBOUND-DEBUG] è¿”å›æŠ•èµ„å†³ç­–:",G.map(o=>`${o.investorNation.name} -> ${o.building.name}`)),{investments:G,hasMore:f,nextOffset:g}}function Y({targetBuildings:e={},targetJobFill:t={},epoch:l=0,market:i=null,investorWealth:r=1/0,foreignInvestments:v=[]}){const B=A.filter(s=>{if(s.cat!=="gather"&&s.cat!=="industry"||(s.epoch||0)>l||!s.baseCost&&!s.cost)return!1;const u=s.jobs||{};if(!Object.keys(u).some(n=>n!==s.owner))return console.log(`[æŠ•èµ„ç­›é€‰] æ’é™¤ ${s.name}: æ²¡æœ‰é›‡ä½£å…³ç³» (owner=${s.owner}, jobs=${Object.keys(u).join(",")})`),!1;const g=e[s.id]||0;if(g<=0)return!1;const m=(v||[]).filter(n=>n.buildingId===s.id&&n.status==="operating").reduce((n,d)=>n+(d.count||1),0);if(m>=g)return console.log(`[æŠ•èµ„ç­›é€‰] æ’é™¤ ${s.name}: å¤–èµ„æ•°é‡å·²è¾¾ä¸Šé™ (${m}/${g})`),!1;if(t&&Object.keys(t).length>0){const n=t[s.id]||{},d=s.jobs||{};let h=0,b=0;Object.entries(d).forEach(([N,C])=>{const p=C*g;h+=p,b+=Math.min(n[N]||0,p)});const D=h>0?b/h:1;if(D<J)return console.log(`[æŠ•èµ„ç­›é€‰] æ’é™¤ ${s.name}: åˆ°å²—ç‡ä¸è¶³ (${(D*100).toFixed(1)}% < 95%)`),!1}const o=s.baseCost||s.cost||{};return!((Object.values(o).reduce((n,d)=>n+(typeof d=="number"?d:0),0)||1e3)*1.5>r)});if(B.length===0)return console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å»ºç­‘"),null;console.log(`[æŠ•èµ„ç­›é€‰] æ‰¾åˆ° ${B.length} ä¸ªå€™é€‰å»ºç­‘: ${B.map(s=>s.name).join(", ")}`);let U=null,E=-1/0,I=0;const a={};Object.keys($).forEach(s=>{var u,f;a[s]=((u=i==null?void 0:i.prices)==null?void 0:u[s])||((f=$[s])==null?void 0:f.basePrice)||1});for(const s of B){const u=s.baseCost||s.cost||{},g=(Object.values(u).reduce((D,N)=>D+(typeof N=="number"?N:0),0)||1e3)*1.5;let m=0;const G=s.output||{};Object.entries(G).forEach(([D,N])=>{if(D==="maxPop"||D==="militaryCapacity")return;const C=a[D]||1;m+=N*C});let o=0;const O=s.input||{};Object.entries(O).forEach(([D,N])=>{const C=a[D]||1;o+=N*C});let c=0;const n=s.jobs||{},d=(i==null?void 0:i.wages)||{};Object.entries(n).forEach(([D,N])=>{var p;if(s.owner&&D===s.owner)return;const C=(p=d[D])!=null?p:.1;c+=N*C});const h=m-o-c,b=g>0?h*360/g:0;console.log(`[æŠ•èµ„ç­›é€‰] ${s.name}: profit=${h.toFixed(1)}/day, cost=${g}, ROI=${(b*100).toFixed(1)}%`),b>E&&(E=b,U=s,I=g)}return U?(console.log(`[æŠ•èµ„ç­›é€‰] é€‰æ‹©æœ€ä½³å»ºç­‘: ${U.name} (ROI=${(E*100).toFixed(1)}%)`),{building:U,cost:I,roi:E}):(console.log("[æŠ•èµ„ç­›é€‰] æ²¡æœ‰æ‰¾åˆ°æ­£ROIçš„å»ºç­‘"),null)}export{Y as selectBestInvestmentBuilding,se as selectInboundInvestmentsBatch,ee as selectOutboundInvestmentsBatch};
