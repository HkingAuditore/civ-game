# 外交系统扩充完整实施计划

## 📋 实施原则

1. **先修复再扩展** - 优先修复已有但不工作的功能
2. **先后端再前端** - 确保逻辑正确后再做UI
3. **先核心再周边** - 优先实现影响游戏性的核心功能
4. **渐进式集成** - 每完成一个模块就测试验证

---

## 🗓️ 总体时间线

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 阶段1: 基础修复 (1-2周)                                                      │
│   └─ 修复已有代码的数据依赖和数值问题                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ 阶段2: 系统集成 (1周)                                                        │
│   └─ 将已写好但未集成的系统接入游戏主循环                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ 阶段3: 功能完善 (2周)                                                        │
│   └─ 补全条约成本、多轮谈判、附庸控制等核心机制                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│ 阶段4: 新系统开发 (2-3周)                                                    │
│   └─ 实现外国叛乱、市场联动等全新系统                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│ 阶段5: UI优化 (1周)                                                          │
│   └─ 完善所有UI入口和交互体验                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│ 阶段6: 平衡调优 (持续)                                                        │
│   └─ 数值平衡和游戏性测试                                                      │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 阶段1: 基础修复 (预计1-2周)

### 1.1 AI国家经济数据初始化 🔴 最高优先级

**目标：** 让AI国家拥有可用的经济数据，解决海外投资、朝贡等系统的数据依赖问题

**涉及文件：**
- `src/logic/diplomacy/nations.js` - AI国家初始化
- `src/hooks/useGameLoop.js` - AI国家每日更新
- `src/config/diplomacy.js` - 默认配置

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 1.1.1 | 初始化AI国家价格数据 | 在 `initializeNation` 中添加 `nationPrices` 基于玩家市场价格±20%随机波动 | AI国家有非空价格对象 |
| 1.1.2 | 初始化AI国家库存数据 | 添加 `nationInventories` 基于国家规模配置初始库存 | AI国家有资源库存 |
| 1.1.3 | AI价格每日更新 | 在游戏主循环中每天更新AI价格（随机波动±5%） | 价格不再静态 |
| 1.1.4 | AI资源产出消耗 | 简化模拟AI国家的日常资源变化 | 库存会动态变化 |

**代码示例（概念）：**
```javascript
// nations.js - initializeNation 函数增强
function initializeNation(config, gameState) {
    const nation = {
        // ... 现有属性
        
        // 新增：基于玩家市场的价格数据
        nationPrices: Object.fromEntries(
            Object.entries(gameState.marketPrices).map(([res, price]) => [
                res,
                price * (0.8 + Math.random() * 0.4) // ±20%波动
            ])
        ),
        
        // 新增：基于国家规模的库存
        nationInventories: generateInitialInventory(config.economyScale),
        
        // 新增：简化阶层结构
        socialStructure: generateSocialStructure(config.governmentType),
    };
    return nation;
}
```

---

### 1.2 AI简化阶层系统初始化 🔴 高优先级

**目标：** 让附庸满意度计算生效

**涉及文件：**
- `src/logic/diplomacy/nations.js`
- `src/config/diplomacy.js` - 添加阶层配置模板

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 1.2.1 | 定义阶层配置模板 | 在config中定义不同政体的默认阶层比例 | 配置文件完整 |
| 1.2.2 | 国家初始化时赋予阶层 | 基于政体类型分配初始 `socialStructure` | 所有AI国家有阶层数据 |
| 1.2.3 | 阶层满意度计算 | 基于附庸政策、条约、事件更新满意度 | 满意度会变化 |
| 1.2.4 | 阶层影响独立倾向 | 将阶层满意度整合到独立倾向计算 | 低满意度加速独立 |

**阶层配置示例：**
```javascript
// config/diplomacy.js
export const SOCIAL_STRUCTURE_TEMPLATES = {
    monarchy: {
        elites: { ratio: 0.10, baseSatisfaction: 75, influence: 0.45 },
        commoners: { ratio: 0.80, baseSatisfaction: 50, influence: 0.35 },
        underclass: { ratio: 0.10, baseSatisfaction: 35, influence: 0.20 },
    },
    republic: {
        elites: { ratio: 0.15, baseSatisfaction: 65, influence: 0.35 },
        commoners: { ratio: 0.75, baseSatisfaction: 60, influence: 0.45 },
        underclass: { ratio: 0.10, baseSatisfaction: 45, influence: 0.20 },
    },
    // ... 其他政体
};
```

---

### 1.3 海外投资利润计算修复 🔴 高优先级

**目标：** 让海外建筑产生实际收益

**涉及文件：**
- `src/logic/diplomacy/overseasInvestment.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 1.3.1 | 修复价格获取逻辑 | 当AI价格为空时，使用玩家市场价格×0.9作为后备 | 不再返回0利润 |
| 1.3.2 | 修复库存获取逻辑 | 当AI库存为空时，基于建筑产能模拟虚拟库存 | 交易量计算正确 |
| 1.3.3 | 实现资源实际流动 | 计算的 `localResourceChanges` 实际修改AI库存 | 资源有真实变化 |
| 1.3.4 | 添加利润历史记录 | 记录每个建筑的日/周/月利润便于UI展示 | 有历史数据可查 |

---

### 1.4 朝贡数值调整 🟡 中优先级

**目标：** 让附庸朝贡有游戏意义

**涉及文件：**
- `src/logic/diplomacy/vassalSystem.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 1.4.1 | 重新设计朝贡基数 | 改为 `max(玩家财富 * 0.01, 固定基数 500) * 附庸规模系数` | 朝贡至少数百银 |
| 1.4.2 | 添加资源朝贡 | 除金钱外，附庸每月上贡一定资源 | 有资源实际转移 |
| 1.4.3 | 朝贡可见性增强 | 在UI中显示预期朝贡和历史朝贡记录 | 玩家知道能得到什么 |

---

### 1.5 独立倾向数值调整 🟡 中优先级

**目标：** 让附庸存在真实威胁

**涉及文件：**
- `src/logic/diplomacy/vassalSystem.js`
- `src/config/diplomacy.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 1.5.1 | 提高基础增长率 | 从每日0.01-0.05提高到0.1-0.5 | 月增长约3-15点 |
| 1.5.2 | 添加事件触发器 | 阶层满意度低于30时大幅增加独立倾向 | 有突发性变化 |
| 1.5.3 | 添加控制手段效果 | 实现派遣总督（-20%/天）、驻军（-30%/天）等效果 | 玩家有应对手段 |
| 1.5.4 | 独立战争增强 | 独立战争期间附庸停止朝贡、可能获得其他国家支持 | 独立有代价 |

---

## 阶段2: 系统集成 (预计1周)

### 2.1 国际组织系统集成 🔴 高优先级

**目标：** 让已写好的国际组织代码生效

**涉及文件：**
- `src/logic/diplomacy/organizationDiplomacy.js` - 现有逻辑
- `src/hooks/useGameLoop.js` - 集成调用
- `src/hooks/useGameActions.js` - 玩家操作
- `src/components/diplomacy/` - UI组件

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 2.1.1 | 在游戏循环中调用组织效果 | 每日调用组织效果计算函数 | 组织效果生效 |
| 2.1.2 | 实现创建组织Action | 玩家可以创建指定类型的国际组织 | 创建功能可用 |
| 2.1.3 | 实现加入/退出Action | 玩家可以申请加入或退出组织 | 成员变更功能可用 |
| 2.1.4 | AI自动加入逻辑 | AI国家根据利益计算决定是否加入玩家创建的组织 | AI会响应邀请 |
| 2.1.5 | 创建组织列表UI | 显示所有组织、成员、效果 | 可查看组织信息 |
| 2.1.6 | 创建组织操作UI | 创建、加入、退出按钮和模态框 | 可进行组织操作 |

**UI设计建议：**
```
┌─────────────────────────────────────────┐
│ 国际组织                            [+] │
├─────────────────────────────────────────┤
│ 🏛️ 泛欧同盟 (贸易联盟)                  │
│    成员: 本国、法兰西、神圣罗马          │
│    效果: 关税-15%, 贸易+10%              │
│    [退出]                               │
├─────────────────────────────────────────┤
│ ⚔️ 反土耳其联盟 (军事同盟)              │
│    成员: 本国、波兰、匈牙利              │
│    效果: 对土作战+15%战力                │
│    [退出]                               │
└─────────────────────────────────────────┘
```

---

### 2.2 人口流动系统集成 🔴 高优先级

**目标：** 让已写好的移民代码生效

**涉及文件：**
- `src/logic/diplomacy/populationMigration.js` - 现有逻辑
- `src/hooks/useGameLoop.js` - 集成调用
- `src/stores/` - 玩家边境政策状态
- `src/components/` - UI组件

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 2.2.1 | 每月调用迁移处理 | 在月度循环中调用 `processMonthlyMigration` | 移民逻辑执行 |
| 2.2.2 | 添加边境政策状态 | 在gameState中添加 `borderPolicy: 'open'/'controlled'/'closed'` | 政策可设置 |
| 2.2.3 | 移民事件通知 | 大规模移民时生成事件通知玩家 | 玩家知道发生了什么 |
| 2.2.4 | 移民影响计算 | 移民带来/带走财富、技能、人口 | 有实际游戏影响 |
| 2.2.5 | 边境政策UI | 在设置或外交面板添加边境政策选项 | 可设置政策 |
| 2.2.6 | 移民统计UI | 显示近期移民流向、人数、影响 | 可查看移民情况 |

---

### 2.3 外资系统实现 🟡 中优先级

**目标：** 实现外国在本国投资的双向机制

**涉及文件：**
- `src/logic/diplomacy/overseasInvestment.js` - 扩展
- `src/hooks/useGameLoop.js`
- 新建 `src/components/diplomacy/ForeignInvestmentPanel.jsx`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 2.3.1 | 定义外资数据结构 | 在gameState中添加 `foreignInvestments` 数组 | 数据结构完整 |
| 2.3.2 | AI投资决策逻辑 | AI根据关系、条约、利润预期决定是否投资玩家国家 | AI会主动投资 |
| 2.3.3 | 外资利润分配 | 外资建筑利润按比例分给AI国家 | 利润正确分配 |
| 2.3.4 | 玩家干预选项 | 可选择国有化、限制、优惠等政策 | 有互动选项 |
| 2.3.5 | 外资面板UI | 显示本国境内外资企业列表及操作 | UI可用 |

---

## 阶段3: 功能完善 (预计2周)

### 3.1 条约签约成本与维护费 🔴 高优先级

**目标：** 让条约有博弈意义

**涉及文件：**
- `src/logic/diplomacy/treatyEffects.js`
- `src/config/diplomacy.js`
- `src/hooks/useGameActions.js`
- `src/hooks/useGameLoop.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 3.1.1 | 实现签约成本计算 | `min(双方财富) * 条约成本系数(1-5%)` | 签约需要付钱 |
| 3.1.2 | 签约时扣除成本 | 在签约Action中扣除双方财富 | 财富实际减少 |
| 3.1.3 | 实现每日维护费 | 条约每天扣除少量维护费 | 有持续成本 |
| 3.1.4 | 维护费不足处理 | 财富不足时条约自动失效 | 有惩罚机制 |
| 3.1.5 | UI显示成本 | 签约确认框显示预计成本和维护费 | 玩家知道代价 |

**配置示例：**
```javascript
// config/diplomacy.js
export const TREATY_COSTS = {
    non_aggression: { signingCostRate: 0.01, dailyMaintenance: 5 },
    trade_agreement: { signingCostRate: 0.02, dailyMaintenance: 10 },
    military_alliance: { signingCostRate: 0.05, dailyMaintenance: 25 },
    free_trade: { signingCostRate: 0.03, dailyMaintenance: 15 },
    // ...
};
```

---

### 3.2 多轮谈判系统 🔴 高优先级

**目标：** 让条约签署有讨价还价过程

**涉及文件：**
- `src/logic/diplomacy/negotiation.js` - 完善
- 新建 `src/components/diplomacy/NegotiationModal.jsx`
- `src/hooks/useGameActions.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 3.2.1 | 谈判状态管理 | 创建 `negotiationState` 管理进行中的谈判 | 可追踪谈判进度 |
| 3.2.2 | 实现谈判筹码系统 | 定义现金赠礼、资源赠礼、领土让步、军事威胁等筹码 | 筹码类型完整 |
| 3.2.3 | 筹码效果计算 | 不同筹码影响AI接受概率 | 有量化效果 |
| 3.2.4 | AI反提案生成 | 完善 `generateCounterProposal` 生成合理反提案 | AI会还价 |
| 3.2.5 | 谈判轮次限制 | 最多5轮，超时自动失败 | 有时间压力 |
| 3.2.6 | 谈判模态框UI | 显示当前提案、筹码选择、AI态度、历史记录 | 交互完整 |
| 3.2.7 | 谈判事件通知 | AI发起谈判或反提案时通知玩家 | 不会错过谈判 |

**UI设计建议：**
```
┌─────────────────────────────────────────────────────┐
│ 与法兰西的条约谈判 (第2轮/共5轮)                      │
├─────────────────────────────────────────────────────┤
│ 📜 当前提案: 自由贸易协定                            │
│                                                     │
│ 💰 法兰西态度: 犹豫 (接受概率: 45%)                  │
│                                                     │
│ 📦 添加筹码:                                        │
│    [√] 现金赠礼: 500银币  (+15%接受率)               │
│    [ ] 资源赠礼: 选择资源...                        │
│    [ ] 军事威胁         (+10%但-20关系)             │
│                                                     │
│ 预计接受概率: 60%                                    │
│                                                     │
│ [发送提案]  [放弃谈判]                               │
├─────────────────────────────────────────────────────┤
│ 📋 谈判历史:                                        │
│   第1轮: 我方提出，法兰西要求添加200银赠礼           │
└─────────────────────────────────────────────────────┘
```

---

### 3.3 附庸控制手段完善 🟡 中优先级

**目标：** 让玩家有手段管理附庸

**涉及文件：**
- `src/logic/diplomacy/vassalSystem.js`
- `src/components/diplomacy/VassalPolicyModal.jsx`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 3.3.1 | 实现派遣总督 | 消耗金钱，每日降低独立倾向，提升精英满意度 | 效果生效 |
| 3.3.2 | 实现驻军占领 | 消耗军费，大幅降低独立倾向，降低平民满意度 | 效果生效 |
| 3.3.3 | 实现文化同化 | 长期投入，缓慢降低独立倾向上限 | 效果生效 |
| 3.3.4 | 实现经济扶持 | 消耗金钱，提升平民/下层满意度 | 效果生效 |
| 3.3.5 | 控制成本计算 | 根据附庸规模计算各手段成本 | 成本合理 |
| 3.3.6 | 完善UI反馈 | 显示当前状态、效果预览、成本 | 信息清晰 |

---

### 3.4 违约后果增强 🟡 中优先级

**目标：** 让违约有足够威慑

**涉及文件：**
- `src/logic/diplomacy/treatyEffects.js`
- `src/hooks/useGameActions.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 3.4.1 | 商人驱逐效果 | 违约后驱逐该国所有商人 | 商人被移除 |
| 3.4.2 | 贸易中断效果 | 违约后N天内无法与该国贸易 | 贸易被锁定 |
| 3.4.3 | 海外资产冻结 | 违约后该国海外建筑利润冻结 | 利润归零 |
| 3.4.4 | 声誉惩罚 | 违约降低与所有国家的信任度 | 全局关系下降 |
| 3.4.5 | 违约记录 | 记录历史违约次数，影响未来条约签署 | AI会记仇 |

---

## 阶段4: 新系统开发 (预计2-3周)

### 4.1 外国叛乱与政权更迭系统 🔴 高优先级

**目标：** 让世界更加动态有趣

**涉及文件：**
- 新建 `src/logic/diplomacy/rebellionSystem.js`
- `src/logic/diplomacy/nations.js`
- `src/hooks/useGameLoop.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 4.1.1 | AI稳定度系统 | 为AI国家添加 `stability` 属性，每日基于多因素计算 | 稳定度会变化 |
| 4.1.2 | 稳定度影响因素 | 战争、经济、阶层满意度、外部干预等影响稳定度 | 因素完整 |
| 4.1.3 | 异见组织度 | 稳定度低时异见组织度上升 | 有积累机制 |
| 4.1.4 | 叛乱触发 | 异见组织度达到阈值时触发内战 | 可触发叛乱 |
| 4.1.5 | 叛军政权 | 创建叛军势力作为临时"国家" | 有叛军实体 |
| 4.1.6 | 内战结算 | 基于双方实力、外部支持计算内战胜负 | 有结果判定 |
| 4.1.7 | 政权更迭 | 叛军胜利时更换政权，可能改变政体和外交关系 | 世界会变化 |
| 4.1.8 | 玩家干预选项 | 资助反对派、支持政府、军事干预等选项 | 玩家可介入 |
| 4.1.9 | 叛乱UI面板 | 显示各国稳定度、进行中内战、干预选项 | UI可用 |

**稳定度计算示例：**
```javascript
function calculateStability(nation, gameState) {
    let stability = nation.baseStability || 50;
    
    // 战争影响
    if (nation.atWar) stability -= 15;
    
    // 阶层满意度影响
    const avgSatisfaction = calculateAverageSatisfaction(nation.socialStructure);
    stability += (avgSatisfaction - 50) * 0.3;
    
    // 经济影响
    if (nation.economicGrowth < 0) stability -= 10;
    
    // 外部干预影响
    stability += nation.foreignSupport || 0;
    stability -= nation.foreignDestabilization || 0;
    
    return Math.max(0, Math.min(100, stability));
}
```

---

### 4.2 市场价格联动系统 🟡 中优先级

**目标：** 让自由贸易协定有真实经济效果

**涉及文件：**
- `src/logic/trading.js`
- `src/logic/diplomacy/treatyEffects.js`
- `src/hooks/useGameLoop.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 4.2.1 | 价格收敛算法 | 自由贸易协定国家间价格每日靠近5% | 价格趋同 |
| 4.2.2 | 收敛上限 | 最终价差不超过10% | 不会完全相同 |
| 4.2.3 | 资源套利机会 | 价差大时可低买高卖 | 有套利玩法 |
| 4.2.4 | 价格联动UI | 显示各国同类商品价格对比 | 可查看价差 |

---

### 4.3 时代演进效果补全 🟢 低优先级

**目标：** 让游戏后期外交更丰富

**涉及文件：**
- `src/config/diplomacy.js`
- `src/logic/diplomacy/treatyEffects.js`
- `src/logic/diplomacy/vassalSystem.js`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 4.3.1 | 商人派驻效率演进 | 后期时代商人效率提升 | 效率随时代变化 |
| 4.3.2 | 殖民控制力演进 | 后期殖民成本降低、效率提升 | 殖民更有效 |
| 4.3.3 | 条约复杂度演进 | 后期解锁更复杂条约组合 | 有新玩法 |
| 4.3.4 | 国际组织演进 | 后期解锁更强组织类型 | 组织更多样 |

---

## 阶段5: UI优化 (预计1周)

### 5.1 外交中心整合 🔴 高优先级

**目标：** 创建统一的外交操作入口

**涉及文件：**
- `src/components/diplomacy/DiplomacyTab.jsx` - 重构
- 新建 `src/components/diplomacy/DiplomacyCenterModal.jsx`

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 5.1.1 | 外交中心模态框 | 整合所有外交功能的统一入口 | 一站式操作 |
| 5.1.2 | 国家选择器优化 | 支持按关系、条约、类型筛选国家 | 快速找到目标 |
| 5.1.3 | 快捷操作面板 | 常用操作（签约、谈判、投资）一键访问 | 操作便捷 |
| 5.1.4 | 通知中心 | 外交事件、条约到期、谈判请求集中显示 | 不遗漏信息 |

**UI布局建议：**
```
┌───────────────────────────────────────────────────────────────┐
│ 外交中心                                               [×]   │
├───────────────────────────────────────────────────────────────┤
│ [国家关系] [条约管理] [国际组织] [海外投资] [附庸管理] [移民] │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─────────────┐  ┌──────────────────────────────────────┐  │
│  │ 国家列表     │  │  选中国家详情                        │  │
│  │             │  │                                      │  │
│  │ 🇫🇷 法兰西   │  │  法兰西王国                          │  │
│  │   关系: 75  │  │  关系: 75 (友好)                     │  │
│  │             │  │                                      │  │
│  │ 🇪🇸 西班牙   │  │  现有条约:                           │  │
│  │   关系: 45  │  │  - 贸易协定 (剩余89天)               │  │
│  │             │  │  - 互不侵犯 (剩余200天)              │  │
│  │ 🇩🇪 神罗     │  │                                      │  │
│  │   关系: 30  │  │  [签署新条约] [开始谈判] [海外投资]   │  │
│  │             │  │                                      │  │
│  └─────────────┘  └──────────────────────────────────────┘  │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

---

### 5.2 信息可视化增强 🟡 中优先级

**目标：** 让玩家更容易理解外交状态

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 5.2.1 | 关系网络图 | 可视化国家间关系网络 | 直观了解格局 |
| 5.2.2 | 条约时间轴 | 显示条约签署、到期、历史 | 掌握时间节点 |
| 5.2.3 | 收益统计图表 | 海外投资、朝贡等收益趋势图 | 量化收益 |
| 5.2.4 | 世界稳定度地图 | 显示各国稳定度、叛乱风险 | 预判变化 |

---

### 5.3 工具提示与帮助 🟡 中优先级

**目标：** 降低学习成本

**具体任务：**

| 序号 | 任务 | 详情 | 验收标准 |
|------|------|------|----------|
| 5.3.1 | 条约效果提示 | 鼠标悬停显示条约详细效果 | 知道签约好处 |
| 5.3.2 | 数值来源提示 | 显示各数值的计算来源 | 理解机制 |
| 5.3.3 | 新手引导 | 首次打开外交面板时的引导 | 快速上手 |
| 5.3.4 | 帮助文档链接 | 关键位置链接到帮助文档 | 有处查阅 |

---

## 阶段6: 平衡调优 (持续进行)

### 6.1 数值平衡

| 系统 | 关注指标 | 目标范围 |
|------|----------|----------|
| 朝贡 | 月收入占比 | 占总收入5-15% |
| 海外投资 | 投资回报率 | 年化10-30% |
| 条约成本 | 签约成本占比 | 占财富1-5% |
| 独立倾向 | 首次独立时间 | 2-5年游戏时间 |
| 移民影响 | 人口变化率 | 年变化不超过5% |

### 6.2 游戏性测试清单

- [ ] 条约博弈：是否有签/不签的权衡
- [ ] 附庸管理：是否需要持续关注
- [ ] 海外投资：是否有策略选择
- [ ] 国际组织：是否影响决策
- [ ] 叛乱系统：是否增加世界变化
- [ ] 移民系统：是否需要政策调整

---

## 📁 新增文件清单

```
src/
├── logic/diplomacy/
│   └── rebellionSystem.js          # 新建 - 叛乱系统
├── components/diplomacy/
│   ├── DiplomacyCenterModal.jsx    # 新建 - 外交中心
│   ├── NegotiationModal.jsx        # 新建 - 谈判模态框
│   ├── OrganizationPanel.jsx       # 新建 - 国际组织面板
│   ├── MigrationPanel.jsx          # 新建 - 移民面板
│   ├── ForeignInvestmentPanel.jsx  # 新建 - 外资面板
│   └── RebellionPanel.jsx          # 新建 - 叛乱面板
└── config/
    └── diplomacy.js                # 修改 - 添加新配置
```

---

## ✅ 里程碑检查点

| 里程碑 | 完成标准 | 预计时间 |
|--------|----------|----------|
| M1 | AI国家有价格/库存/阶层数据，海外投资有利润 | 1周 |
| M2 | 国际组织和移民系统可通过UI操作 | 2周 |
| M3 | 条约有成本，谈判可讨价还价 | 3周 |
| M4 | 世界会发生叛乱和政权更迭 | 5周 |
| M5 | UI整合完成，信息清晰 | 6周 |
| M6 | 数值平衡，游戏性验证通过 | 7周+ |

---

## 📝 附录：现状分析摘要

### 已实现但存在问题的功能

| 模块 | 代码实现度 | 主要问题 |
|------|------------|----------|
| 条约体系 | 70% | 缺成本/维护费 |
| 附庸系统 | 65% | 数值/阶层问题 |
| 海外投资 | 55% | 利润计算失效 |

### 已创建文件但未集成的功能

| 模块 | 代码实现度 | 主要问题 |
|------|------------|----------|
| 国际组织 | 80% | 未被调用，无UI |
| 人口流动 | 70% | 未被调用，无UI |

### 完全未实现的功能

- 外国叛乱与政权更迭系统
- AI简化阶层模拟初始化
- 市场价格联动
- 多轮谈判UI
- 外资系统（双向投资）

---

*文档创建日期: 2026-01-11*
*最后更新: 2026-01-11*
