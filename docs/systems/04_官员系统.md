# 官员系统 - 完整机制

> **核心逻辑**: `logic/officials/manager.js`, `config/officials.js`

---

## 1. 系统概述

官员系统核心循环：
```
选拔候选人 → 雇佣 → 日常效果 → 忠诚度变化 → 可能政变/解雇
     ↓
效果聚合 → 应用到生产/政治/经济
```

---

## 2. 选拔与雇佣

### 2.1 选拔机制 (L29-36)

每180天可触发一次选拔，生成5名候选人：
```javascript
OFFICIAL_SELECTION_COOLDOWN = 180  // 半年冷却
candidates = generateRandomOfficial(epoch, popStructure, classInfluence, market, rates)
```

候选人属性由阶层影响力加权随机生成。

### 2.2 官员容量 (L151-170)

```javascript
容量 = 基础(2) + 时代加成 + 科技加成 + 政体加成

// 时代加成 (EPOCH_OFFICIAL_BONUS)
时代0-7: +0/+3/+6/+9/+12/+15/+18/+21

// 科技加成 (TECH_OFFICIAL_BONUS)
early_administration: +2
bureaucracy: +3
civil_service: +3
administrative_reform: +4
centralization: +2
```

### 2.3 雇佣时属性 (L64-88)

```javascript
{
    hireDate: currentDay,
    wealth: 400,  // 初始官员存款
    baseSalary: candidate.salary,
    loyalty: 50-100 + 薪水加成(max+10),
    investmentProfile: ...,  // 投资偏好
}
```

---

## 3. 效果系统

### 3.1 效果聚合 (L178-409)

官员效果按类型聚合：

| 类别 | 效果类型 | 目标 |
|-----|---------|-----|
| 生产 | `buildings`, `categories`, `wartimeProduction` | 特定建筑/类别 |
| 经济 | `tradeBonus`, `taxEfficiency`, `buildingCostMod` | 全局 |
| 政治 | `approval`, `legitimacyBonus`, `stability` | 阶层/全局 |
| 军事 | `militaryBonus`, `militaryUpkeep` | 全局 |
| 外交 | `diplomaticBonus`, `diplomaticCooldown` | 全局 |

### 3.2 未支付薪水惩罚 (L229)

```javascript
multiplier = isPaid ? 1 : 0.5  // 效果减半
```

### 3.3 财务状态惩罚 (L373-378)

官员个人财务困难时（`financialSatisfaction`）：
```javascript
effectiveMultiplier = multiplier × financialPenalty.effectMult
// 同时增加corruption
```

---

## 4. 威望系统

### 4.1 威望计算 (L721-761)

```javascript
威望 = (能力分 + 财富分 + 任期分) × 阶层修正

// 能力分 = Σ|效果值| × 权重，上限40
// 财富分 = log10(wealth+1) × 5，上限30
// 任期分 = min(任期年数, 10) × 2，上限20

// 阶层修正
landowner/knight: 1.10
official: 1.05
peasant/worker: 0.95
serf: 0.90
```

### 4.2 威望等级 (L768-773)

| 威望 | 等级 | 名称 |
|-----|-----|-----|
| ≥80 | legendary | 一代权臣 |
| ≥50 | renowned | 德高望重 |
| ≥25 | notable | 小有名气 |
| <25 | obscure | 无名小卒 |

---

## 5. 影响力贡献

### 5.1 绝对影响力 (L417-494)

官员对出身阶层提供影响力加成：

```javascript
绝对影响力 = (阶层基座 + 动态基座 + 财富分 + 产业分 + 遗产分)
             × 任期因子 × 官僚因子

// 阶层基座 (stratumBase)
capitalist: 260, landowner: 240, merchant: 170, peasant: 75...

// 动态基座
dynamicBase = log10(阶层当前影响力+1) × 70

// 任期因子
tenureFactor = 1 + min(2.5, log2(任期年数+1) × 0.9)  // 最高~3.5x
```

### 5.2 影响力分配 (L517-548)

```javascript
// 出身阶层获得完整加点
pointsMap[stratum] += points

// 官员阶层额外获得25%
pointsMap['official'] += points × 0.25
```

单官员上限2万点影响力。

---

## 6. 政治立场

### 6.1 立场条件检查 (L673-689)

每个官员有独特的立场条件和效果：

```javascript
if (isStanceSatisfied(stance, gameState, params)) {
    applyEffects(stanceActiveEffects)      // 满足：正面效果
} else {
    applyEffects(stanceUnsatisfiedPenalty) // 不满足：负面效果
}
```

### 6.2 立场效果类型 (L601-636)

- 稳定度/合法性
- 生产类（gather/industry/research）
- 经济类（税效/收入/建筑成本）
- 阶层满意度
- 军事/外交

---

## 7. 忠诚度与政变

### 7.1 忠诚度变化 (`officials.js` LOYALTY_CONFIG)

```javascript
LOYALTY_CONFIG = {
    INITIAL_MIN: 50,
    INITIAL_MAX: 100,
    COUP_THRESHOLD: 25,        // 政变触发忠诚度
    COUP_DURATION_DAYS: 180,   // 需持续天数
    
    DAILY_CHANGES: {
        stanceSatisfied: +0.40,
        stanceUnsatisfied: -0.30,
        salaryPaid: +0.15,
        salaryUnpaid: -0.30,
    },
}
```

### 7.2 处置时政变 (L905-933)

```javascript
DISPOSAL_PENALTY = {
    fire: { loyalty: -30, coupChance: 0.15 },
    exile: { loyalty: -50, coupChance: 0.35 },
    execute: { loyalty: -80, coupChance: 0.60 },
}

// 忠诚度≤0时概率翻倍
if (finalLoyalty <= 0) coupChance *= 2

// 需有资本才能政变
hasCapital = wealth >= threshold || propertyCount >= threshold
```

---

## 8. 处置系统

### 8.1 处置类型 (L780-817)

| 类型 | 没收财产 | 满意度惩罚 | 稳定度惩罚 | 产业结果 |
|-----|---------|-----------|-----------|---------|
| fire(解雇) | 0% | 0 | 0 | 倒闭 |
| exile(流放) | 50% | 威望×0.5 | -2% | 倒闭 |
| execute(处死) | 100% | 威望×1.0 | -5% | 转交 |

### 8.2 后果计算 (L826-862)

```javascript
wealthSeized = wealth × type.wealthSeized
approvalPenalty = min(50, prestige × type.approvalPenaltyMultiplier)
organizationBonus = type.organizationBonus × (prestige / 50)
```

---

## 9. 玩法策略

### 9.1 官员选拔

- 高影响力阶层的候选人更常出现
- 候选人效果随机，关注正面效果强于负面的

### 9.2 维持忠诚

- 按时发薪 (+0.15/天)
- 满足政治立场条件 (+0.40/天)
- 忠诚度<25持续180天会触发政变

### 9.3 利用威望

- 高威望官员影响力贡献大，但处置代价也高
- 处死高威望官员：满意度惩罚大但抄家收益高
- 解雇低威望官员：无代价但无收益

### 9.4 派系经营

- 官员给出身阶层+影响力，可用于抬升弱势阶层
- 多雇用同阶层官员可强化该派系
- 官员阶层本身获得25%的影响力溢出
