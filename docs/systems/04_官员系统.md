# 官员系统 - 详尽规则书

> **核心代码**:
> - 官员配置: `src/config/officials.js`
> - 官员逻辑: `src/logic/officials/manager.js`
> - 内阁协同: `src/logic/officials/cabinetSynergy.js`
> - 政治立场: `src/config/politicalStances.js`
> - 官员投资: `src/logic/officials/officialInvestment.js`

---

# 第一章：选拔系统

## 1.1 选拔冷却

选拔每隔**180天**（半年）可触发一次（`manager.js` L17）：

```javascript
export const OFFICIAL_SELECTION_COOLDOWN = 180;
```

选拔可用条件（`manager.js` L119-121）：

```javascript
isSelectionAvailable(lastDay, currentDay) {
    return (currentDay - lastDay) >= OFFICIAL_SELECTION_COOLDOWN;
}
```

---

## 1.2 候选人生成

每次选拔生成**5名候选人**（`manager.js` L29-36）：

```javascript
triggerSelection(epoch, popStructure, classInfluence, market, rates) {
    const candidates = [];
    for (let i = 0; i < 5; i++) {
        candidates.push(generateRandomOfficial(epoch, popStructure, classInfluence, market, rates));
    }
    return candidates;
}
```

---

## 1.3 候选人来源阶层

候选人可来自以下阶层（`officials.js` L1181-1185）：

```javascript
const eligibleStrata = [
    'peasant', 'worker',  // 底层也能出官员
    'scribe', 'merchant', 'cleric', 'landowner',
    'engineer', 'artisan', 'soldier', 'navigator', 'capitalist'
];
```

**权重计算**：基于人口和影响力加权随机，人口≥1的阶层才能产生官员。

---

## 1.4 效果生成与时代缩放

候选人效果数值会随时代缩放（`officials.js` L962-976）：

```javascript
时代缩放因子 = min(1.0, 0.25 + 当前时代 × 0.15)

// 各时代缩放因子：
// 时代0: 0.25  (石器时代，效果仅25%)
// 时代1: 0.40  (青铜时代)
// 时代2: 0.55  (古典时代)
// 时代3: 0.70  (封建时代)
// 时代4: 0.85  (探索时代)
// 时代5+: 1.00 (启蒙及之后)
```

---

# 第二章：官员容量

## 2.1 容量计算公式

官员上限由多因素决定（`manager.js` L151-170）：

```javascript
官员容量 = 基础容量(2) + 时代加成 + 政体加成 + 科技加成
```

---

## 2.2 时代加成

每个时代对官员容量的加成（`manager.js` L124-133）：

| 时代ID | 时代名称 | 官员容量加成 |
|-------|---------|------------|
| 0 | 石器时代 | +0 |
| 1 | 青铜时代 | +3 |
| 2 | 古典时代 | +6 |
| 3 | 封建时代 | +9 |
| 4 | 探索时代 | +12 |
| 5 | 启蒙时代 | +15 |
| 6 | 工业时代 | +18 |
| 7 | 信息时代 | +21 |

---

## 2.3 科技加成

解锁特定科技提供额外容量（`manager.js` L136-142）：

| 科技ID | 科技名称 | 容量加成 |
|-------|---------|---------|
| early_administration | 早期行政 | +2 |
| bureaucracy | 官僚制度 | +3 |
| civil_service | 文官制度 | +3 |
| administrative_reform | 行政改革 | +4 |
| centralization | 中央集权 | +2 |

---

## 2.4 政体加成

政体通过`polityEffects.officialCapacity`提供加成。

---

# 第三章：雇佣与解雇

## 3.1 雇佣流程

雇佣官员时的初始化（`manager.js` L47-91）：

```javascript
// 初始财富
const OFFICIAL_STARTING_WEALTH = 400;

// 初始忠诚度计算
baseLoyalty = LOYALTY_CONFIG.INITIAL_MIN + 
    随机 × (INITIAL_MAX - INITIAL_MIN)  // 50-100之间
salaryBonus = min(10, 薪资 / 5)  // 高薪加成最多+10
initialLoyalty = min(100, baseLoyalty + salaryBonus)
```

**新官员初始状态**：
- 财富: 400银
- 忠诚度: 50-100（薪资越高越忠诚）
- 财务满意度: 'satisfied'
- 低忠诚天数: 0
- 产业列表: 空

---

## 3.2 每日薪资

计算所有在任官员的日薪总和（`manager.js` L108-111）：

```javascript
calculateTotalDailySalary(officials) {
    return officials.reduce((sum, off) => sum + (off.salary || 0), 0);
}
```

---

# 第四章：官员效果

## 4.1 效果类型总览

官员效果分为7大类（`officials.js` L14-309, `manager.js` L179-225）：

### 生产类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| building_boost | buildings | +8%~+35% | 特定建筑产出 |
| category_boost | categories | +6%~+30% | 建筑类别产出 |
| wartime_production | wartimeProduction | +12%~+40% | 战时产出 |

### 经济类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| trade_bonus | tradeBonus | +12%~+40% | 贸易利润 |
| tax_efficiency | taxEfficiency | +6%~+25% | 税收效率 |
| building_cost_reduction | buildingCostMod | -10%~-35% | 建筑成本 |
| income_percent | incomePercent | +6%~+22% | 税收收入 |
| production_input_cost | productionInputCost | -8%~-30% | 原料消耗 |
| passive_gain | passive | +50~+2500 | 固定被动产出 |
| passive_percent | passivePercent | +6%~+28% | 百分比被动 |

### 需求/资源类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| stratum_demand | stratumDemandMod | -10%~-35% | 阶层需求降低 |
| resource_demand | resourceDemandMod | -6%~-28% | 资源需求降低 |
| resource_supply | resourceSupplyMod | +12%~+40% | 资源供给增加 |
| needs_reduction | needsReduction | +8%~+28% | 全民需求降低 |

### 人口/发展类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| max_pop | maxPop | +6%~+25% | 人口上限 |
| population_growth | populationGrowth | +12%~+40% | 人口增长 |
| research_speed | researchSpeed | +8%~+30% | 科研速度 |

### 政治类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| approval_boost | approval | +8~+25 | 阶层满意度 |
| stability_bonus | stability | +4%~+15% | 稳定度 |
| organization_decay | organizationDecay | -10%~-35% | 组织度增长抑制 |
| legitimacy_bonus | legitimacyBonus | +5%~+20% | 合法性 |
| coalition_approval | coalitionApproval | +5~+15 | 执政联盟满意度 |

### 军事类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| military_bonus | militaryBonus | +10%~+35% | 军事力量 |
| military_upkeep | militaryUpkeep | -10%~-35% | 军事维护费 |

### 外交类

| 效果类型 | 配置键 | 数值范围 | 说明 |
|---------|-------|---------|-----|
| diplomatic_bonus | diplomaticBonus | +10%~+30% | 外交关系 |
| diplomatic_cooldown | diplomaticCooldown | -10%~-25% | 外交冷却 |

---

## 4.2 负面效果（Drawbacks）

每个官员可能带有负面效果（`officials.js` L311-430）：

| 效果类型 | 数值范围 | 说明 |
|---------|---------|-----|
| category_penalty | -2%~-6% | 类别产出惩罚 |
| passive_cost | +50~+200 | 固定维护费 |
| needs_increase | +4%~+12% | 阶层需求增加 |
| approval_penalty | -2~-8 | 阶层满意度惩罚 |
| corruption | +2%~+8% | 税收损失 |
| faction_conflict | +1%~+4% | 稳定度降低 |
| resource_waste | +2%~+6% | 资源消耗增加 |
| diplomatic_incident | +2%~+6% | 外交冷却 |
| building_cost_increase | +5%~+15% | 建筑成本增加 |
| military_upkeep_increase | +4%~+10% | 军事维护增加 |
| research_slowdown | -2%~-8% | 科研速度 |
| production_input_cost_increase | +5%~+15% | 原料消耗增加 |

---

## 4.3 效果聚合

所有官员效果叠加后应用（`manager.js` L178-409）：

### 薪资影响

```javascript
基础乘数 = 全额发薪 ? 1 : 0.5  // 未发薪效果减半
```

### 财务满意度影响

根据官员财务状态调整效果强度：

```javascript
effectiveMultiplier = 基础乘数 × 财务惩罚系数 × (发薪 ? 1 : 0.5)
```

财务惩罚会降低效果并增加腐败。

---

## 4.4 出身阶层效果偏好

每个阶层有其偏好的效果类型（`officials.js` L476-543），生成时权重×2.5：

| 阶层 | 偏好效果 | 偏好目标 |
|-----|---------|---------|
| peasant | 建筑加成、人口增长、稳定 | 农场、食物 |
| worker | 建筑加成、类别加成、成本降低 | 锯木场、砖厂 |
| scribe | 科研、稳定、税效 | 图书馆 |
| merchant | 贸易、收入、成本降低 | 市场、贸易港 |
| landowner | 建筑、类别、人口 | 农场、大庄园 |
| capitalist | 收入、贸易、税效 | 工厂、市场 |
| soldier | 军事、战时产出、稳定 | 兵营、堡垒 |

---

# 第五章：忠诚度系统

## 5.1 忠诚度配置

忠诚度范围0-100（`officials.js` L433-469）：

```javascript
LOYALTY_CONFIG = {
    INITIAL_MIN: 50,        // 初始最低
    INITIAL_MAX: 100,       // 初始最高
    MAX: 100,               // 上限
    MIN: 0,                 // 下限
    COUP_THRESHOLD: 25,     // 政变阈值
    COUP_DURATION_DAYS: 180,// 需持续天数
    
    COUP_WEALTH_THRESHOLD: 30000,   // 财富门槛
    COUP_PROPERTY_THRESHOLD: 3,     // 产业数量门槛
    COUP_INFLUENCE_THRESHOLD: 0.15, // 影响力占比门槛
}
```

---

## 5.2 每日忠诚度变化

忠诚度每日变化（`officials.js` L445-456）：

| 因素 | 变化值/天 | 触发条件 |
|-----|----------|---------|
| stanceSatisfied | +0.40 | 政治诉求满足 |
| stanceUnsatisfied | -0.30 | 政治诉求不满足 |
| financialSatisfied | +0.30 | 财务满意 |
| financialUncomfortable | -0.10 | 财务不适 |
| financialStruggling | -0.20 | 财务困难 |
| financialDesperate | -0.25 | 财务绝望 |
| stabilityHigh | +0.20 | 稳定度>70% |
| stabilityLow | -0.10 | 稳定度<30% |
| salaryPaid | +0.15 | 按时发薪 |
| salaryUnpaid | -0.30 | 未发薪 |

**累计速度示例**：
- 最佳情况：+0.40+0.30+0.20+0.15 = **+1.05/天** →100天全忠
- 最差情况：-0.30-0.25-0.10-0.30 = **-0.95/天** →100天归零

---

## 5.3 政变触发条件

政变需满足两个要件（`officials.js` L465-468）：

**资格门槛（满足任一）**：
```javascript
- 财富 >= 30000
- 产业数量 >= 3
- 出身阶层影响力占比 >= 15%
```

**触发条件**：
```javascript
忠诚度 < 25 且持续 >= 180天
```

---

# 第六章：威望系统

## 6.1 威望计算公式

威望由三部分组成（`manager.js` L721-761）：

```javascript
威望 = (能力分 + 财富分 + 任期分) × 阶层修正
```

### 能力分（上限40）

```javascript
能力分 = Σ|效果数值| × 效果权重

效果权重（EFFECT_WEIGHTS）:
- buildings: 15
- militaryBonus: 12
- tradeBonus: 10
- taxEfficiency: 10
- researchSpeed: 10
- stability: 8
- industryBonus: 10
- gatherBonus: 8
- incomePercentBonus: 10
- legitimacyBonus: 8
- approval: 0.5
- default: 8
```

### 财富分（上限30）

```javascript
财富分 = min(30, log10(财富 + 1) × 5)

// 示例：
// 财富100 → log10(101)×5 ≈ 10分
// 财富10000 → log10(10001)×5 ≈ 20分
// 财富1000000 → log10(1000001)×5 ≈ 30分（上限）
```

### 任期分（上限20）

```javascript
任期分 = min(20, 任职年数 × 2)

// 示例：
// 1年 → 2分
// 5年 → 10分
// 10年+ → 20分（上限）
```

### 阶层修正

```javascript
地主/骑士: ×1.10
官员: ×1.05
商人/资本家/航海家/文书/教士/工程师/工匠/军人: ×1.00
自耕农/工人/矿工: ×0.95
佃农: ×0.90
```

---

## 6.2 威望等级

威望映射到等级（`manager.js` L768-773）：

| 威望值 | 等级 | 名称 | 颜色 |
|-------|-----|-----|-----|
| ≥80 | legendary | 一代权臣 | 金色 |
| ≥50 | renowned | 德高望重 | 紫色 |
| ≥25 | notable | 小有名气 | 蓝色 |
| <25 | obscure | 无名小卒 | 灰色 |

---

# 第七章：影响力系统

## 7.1 绝对影响力计算

官员为出身阶层贡献影响力（`manager.js` L417-494）：

```javascript
绝对影响力 = (阶层基座 + 动态基座 + 财富分 + 产业分 + 遗产分) 
           × 任期系数 × 官僚系数
```

### 阶层基座（静态）

```javascript
// 上层与新兴精英
capitalist: 260, landowner: 240, knight: 220, official: 200
engineer: 180, merchant: 170

// 中层
scribe: 140, cleric: 140, artisan: 120, navigator: 120

// 底层
soldier: 110, worker: 90, miner: 85, lumberjack: 80
peasant: 75, serf: 65, unemployed: 60
```

### 动态基座

```javascript
动态基座 = log10(出身阶层当前影响力 + 1) × 70
// 阶层越强，该阶层官员影响力越大
```

### 财富/产业分

```javascript
财富分 = log10(个人财富 + 1) × 60
产业数量分 = sqrt(产业数量) × 55
产业等级分 = sqrt(等级总和) × 45
产业价值分 = log10(总资产 + 1) × 40
```

### 任期系数

```javascript
任期系数 = 1 + min(2.5, log2(任职年数 + 1) × 0.9)
// 最高约3.5倍
```

### 官僚系数

```javascript
官僚系数 = 1 + min(1.2, 官员容量 × 0.05)
// 官僚体系越大，单官员撬动力越强，最高2.2倍
```

---

## 7.2 影响力点数分配

官员影响力分配给两个阶层（`manager.js` L540-548）：

```javascript
// 出身阶层获得100%
pointsMap[出身阶层] += 影响力点数

// 官员阶层额外获得25%（非官员出身时）
if (出身阶层 != 'official'):
    pointsMap['official'] += 影响力点数 × 0.25
```

**单官员影响力上限**：20000点（`manager.js` L515）

---

# 第八章：官员处置

## 8.1 处置类型

三种处置方式（`manager.js` L780-817）：

| 属性 | 解雇(fire) | 流放(exile) | 处死(execute) |
|-----|-----------|------------|--------------|
| 没收财产 | 0% | 50% | 100% |
| 满意度惩罚乘数 | 0 | 0.5 | 1.0 |
| 稳定度惩罚 | 0 | -2% | -5% |
| 组织度增加 | 0 | 威望/5 | 威望/2 |
| 产业处理 | 倒闭 | 倒闭 | 转交原业主阶层 |

---

## 8.2 处置后果计算

处置后果计算（`manager.js` L826-862）：

```javascript
// 没收财产
财产收入 = floor(官员财富 × 没收比例)

// 满意度惩罚（应用到出身阶层）
满意度惩罚 = min(50, round(威望 × 惩罚乘数))

// 组织度增加（给出身阶层）
组织度增加 = round(基础值 × (威望 / 50))
```

---

## 8.3 处置政变判定

处置时可能触发政变（`officials.js` L459-463, `manager.js` L905-933）：

```javascript
处置惩罚:
  fire: { loyalty: -30, coupChance: 0.15 }
  exile: { loyalty: -50, coupChance: 0.35 }
  execute: { loyalty: -80, coupChance: 0.60 }

// 政变概率计算
最终忠诚度 = 当前忠诚度 + 惩罚
政变概率 = 基础概率 × (最终忠诚度 <= 0 ? 2 : 1)

// 资格门槛（需有足够资本）
hasCapital = 财富分数 >= 15000 || 产业数量 >= 2

if (hasCapital && random() < 政变概率):
    触发政变
```

---

# 第九章：内阁协同

## 9.1 协同度计算

协同度基于派系分布（`cabinetSynergy.js` L311-344）：

```javascript
// 统计各派系人数（left/center/right）
多样性指数 = (最多派系 - 最少派系) / 总人数

// 协同度 = 50 + 多样性×50
// 派系越集中，协同度越高
```

### 协同度等级效果

| 等级 | 协同度 | 行政效率 | 稳定度 | 组织度增长 | 说明 |
|-----|-------|---------|-------|----------|-----|
| split | 0-30 | -15% | -5% | +20% | 内阁分裂 |
| diverse | 30-50 | 0 | 0 | 0 | 多元共存 |
| coordinated | 50-70 | +5% | 0 | 0 | 协调运作 |
| united | 70-85 | +10% | +2% | 0 | 团结一致 |
| extreme | 85-100 | +15% | 0 | 0 | 一党独大（有反对派惩罚）|

---

## 9.2 派系主导

派系主导需满足条件（`cabinetSynergy.js` L347-428）：

**前置条件**：
```javascript
DOMINANCE_MIN_EPOCH = 5  // 至少启蒙时代
DOMINANCE_MIN_OFFICIAL_RATIO = 0.5  // 官员数达编制50%
DOMINANCE_THRESHOLD = 0.6  // 某派系占60%以上
```

### 派系主导效果

| 派系 | 特殊面板 | 效果 |
|-----|---------|-----|
| left（左派） | 阶层配额规划 | 社会流动+20%，底层满意度+5 |
| center（建制派） | 临时法令 | 外交关系+0.5/天，稳定度+3% |
| right（右派） | 业主自主扩张 | 贸易加成+10%，上层满意度+5 |

---

## 9.3 临时法令

建制派主导时可颁布临时法令（`cabinetSynergy.js` L187-291）：

| 法令 | 持续 | 冷却 | 成本 | 效果 |
|-----|-----|-----|-----|-----|
| 紧急征粮 | 30天 | 180天 | 300 | 采集+30%，稳定度下降 |
| 贸易特许 | 60天 | 240天 | 500 | 税收+25% |
| 工业补贴 | 90天 | 300天 | 800 | 工业+20%，税收-10% |
| 移民激励 | 60天 | 200天 | 400 | 人口增长+15% |
| 军事动员 | 30天 | 150天 | 600 | 军事+25%，稳定度下降 |
| 税收减免 | 45天 | 200天 | 0 | 税收-30%，稳定度+15% |
| 强制劳动 | 60天 | 300天 | 0 | 采集+20%，底层满意大降 |
| 什一税 | 90天 | 360天 | 0 | 收入+10%，教士满意+15 |

---

## 9.4 政策槽位

长期政策槽位计算（`cabinetSynergy.js` L32-62）：

```javascript
政策槽位 = 基础(2) 
         + 在任官员数/2
         + (官员容量-2)/3
         + 时代/2
         + 政体加成

// 范围：1-24
```

---

# 第十章：政治立场

## 10.1 立场效果聚合

官员政治立场影响效果（`manager.js` L600-692）：

```javascript
// 检查每个官员的立场条件
satisfied = isStanceSatisfied(官员立场, 游戏状态, 条件参数)

if (satisfied):
    应用 stanceActiveEffects  // 满足效果
else:
    应用 stanceUnsatisfiedPenalty  // 不满足惩罚
```

政治立场可影响：
- 稳定度、合法性
- 生产加成（采集/工业/贸易）
- 税效、收入、建筑成本
- 人口增长、军事加成
- 阶层满意度

---

# 第十一章：玩法策略

## 11.1 选拔策略

| 优先级 | 考量因素 | 说明 |
|-------|---------|-----|
| 高 | 经济效果（税效/贸易/收入）| 直接增收 |
| 高 | 生产效果（类别加成）| 影响多建筑 |
| 中 | 出身阶层 | 决定影响力方向 |
| 中 | 政治立场 | 影响内阁协同 |
| 低 | 负面效果 | 腐败可抵消收益 |

## 11.2 忠诚度管理

| 策略 | 每日变化 | 说明 |
|-----|---------|-----|
| 满足政治诉求 | +0.40 | 最重要 |
| 按时发薪 | +0.15 | 基础保障 |
| 保持高稳定度 | +0.20 | 稳定度>70% |
| 确保财务满意 | +0.30 | 支持官员投资 |

## 11.3 处置策略

| 场景 | 推荐 | 原因 |
|-----|-----|-----|
| 低威望无产业 | 解雇 | 无惩罚、无政变风险 |
| 贪腐但富有 | 流放 | 获取50%财产 |
| 高威望叛徒 | 处死 | 全抄家+产业转交 |
| 政变高风险 | 先提升忠诚度 | 避免政变 |

## 11.4 内阁构建

| 目标 | 策略 | 效果 |
|-----|-----|-----|
| 高行政效率 | 同派系集中 | 协同度85+，效率+15% |
| 法令能力 | 建制派主导≥60% | 解锁临时法令 |
| 贸易加成 | 右派主导≥60% | 贸易+10% |
| 避免极端 | 多元平衡 | 无反对派惩罚 |

---

# 附录A：核心公式速查

| 计算 | 公式 |
|-----|-----|
| 官员容量 | 2 + 时代加成 + 政体 + 科技 |
| 效果缩放 | min(1.0, 0.25 + 时代×0.15) |
| 威望 | (能力40 + 财富30 + 任期20) × 阶层修正 |
| 影响力 | (阶层基座 + 财富分 + 产业分) × 任期 × 官僚 |
| 协同度 | 50 + (最多派系-最少派系)/总人数 × 50 |
| 政策槽位 | 2 + 官员/2 + (容量-2)/3 + 时代/2 |
| 政变资格 | 财富≥3万 或 产业≥3 或 影响力≥15% |

---

# 附录B：代码位置索引

| 功能 | 文件 | 行号 |
|-----|-----|-----|
| 选拔冷却常量 | manager.js | L17 |
| 候选人生成 | manager.js | L29-36 |
| 容量计算 | manager.js | L151-170 |
| 时代加成表 | manager.js | L124-133 |
| 科技加成表 | manager.js | L136-142 |
| 效果聚合 | manager.js | L178-409 |
| 影响力计算 | manager.js | L417-494 |
| 威望计算 | manager.js | L721-761 |
| 处置类型 | manager.js | L780-817 |
| 忠诚度配置 | officials.js | L433-469 |
| 效果类型定义 | officials.js | L14-309 |
| 负面效果定义 | officials.js | L311-430 |
| 出身偏好 | officials.js | L476-543 |
| 候选阶层列表 | officials.js | L1181-1185 |
| 时代缩放 | officials.js | L962-976 |
| 协同度计算 | cabinetSynergy.js | L311-344 |
| 派系主导 | cabinetSynergy.js | L357-428 |
| 临时法令 | cabinetSynergy.js | L187-291 |
| 政策槽位 | cabinetSynergy.js | L32-62 |
